<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Informasi Digital SDN 4 Taman</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { 
                        primary: '#0f172a', 
                        accent: '#2563eb', 
                        gold: '#fbbf24',
                        emerald: '#10b981',
                        rose: '#f43f5e'
                    }
                }
            }
        }
    </script>
    <style>
        .glass-nav { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }
        .slide-active { opacity: 1; z-index: 10; }
        .slide-hidden { opacity: 0; z-index: 0; }
        .transition-fade { transition: opacity 1s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-accent selection:text-white">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 glass-nav border-b border-slate-200 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-3">
                    <!-- Logo default placeholder -->
                    <div id="logo-container" class="w-10 h-10 bg-accent text-white rounded-lg flex items-center justify-center font-bold text-xl">
                        <i class="fa-solid fa-school"></i>
                    </div>
                    <div>
                        <h1 id="nav-nama-sekolah" class="text-xl font-bold text-primary leading-tight">SDN 4 Taman</h1>
                        <p class="text-xs text-slate-500 font-medium tracking-wider">BERKARAKTER & BERPRESTASI</p>
                    </div>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8 items-center">
                    <a href="#beranda" class="nav-link text-sm font-semibold text-slate-600 hover:text-accent transition">Beranda</a>
                    <a href="#profil" class="nav-link text-sm font-semibold text-slate-600 hover:text-accent transition">Profil</a>
                    <a href="#guru" class="nav-link text-sm font-semibold text-slate-600 hover:text-accent transition">Guru</a>
                    <a href="#berita" class="nav-link text-sm font-semibold text-slate-600 hover:text-accent transition">Berita</a>
                    <a href="#galeri" class="nav-link text-sm font-semibold text-slate-600 hover:text-accent transition">Galeri</a>
                    <button onclick="openLogin()" id="btn-login" class="px-5 py-2.5 bg-primary text-white text-sm font-semibold rounded-full hover:bg-slate-800 transition shadow-lg shadow-primary/30">
                        <i class="fa-solid fa-lock mr-2"></i>Area Guru
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- LOADING SCREEN -->
    <div id="loading" class="fixed inset-0 bg-white z-[60] flex flex-col items-center justify-center">
        <div class="w-16 h-16 border-4 border-slate-200 border-t-accent rounded-full animate-spin mb-4"></div>
        <p class="text-slate-500 font-medium animate-pulse">Memuat Data Sekolah...</p>
    </div>

    <!-- MAIN CONTENT -->
    <main class="pt-20">
        
        <!-- SECTION: HERO SLIDER (Updated) -->
        <section id="beranda" class="relative w-full h-[500px] md:h-[600px] overflow-hidden bg-slate-900">
            <div id="banner-container" class="relative w-full h-full">
                <!-- Fallback Banner if JS fails or empty -->
                <div class="absolute inset-0 bg-cover bg-center transition-fade slide-active" id="default-banner">
                    <div class="absolute inset-0 bg-gradient-to-t from-primary/90 via-primary/40 to-transparent"></div>
                </div>
            </div>
            
            <div class="absolute bottom-0 left-0 w-full p-8 md:p-16 z-20">
                <div class="max-w-7xl mx-auto">
                    <span class="inline-block py-1 px-3 rounded-full bg-accent/20 text-accent border border-accent/30 text-xs font-bold mb-4 backdrop-blur-sm">
                        ‚ú® Selamat Datang
                    </span>
                    <h2 id="hero-title" class="text-4xl md:text-6xl font-extrabold text-white mb-4 leading-tight drop-shadow-lg">
                        Membangun Generasi <br> <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-emerald-400">Emas Indonesia</span>
                    </h2>
                    <p id="hero-desc" class="text-slate-300 text-lg md:text-xl max-w-2xl mb-8 leading-relaxed">
                        Website Resmi Pusat Informasi dan Layanan Digital
                    </p>
                    <div class="flex flex-wrap gap-4">
                        <a href="#ppdb" class="px-8 py-3.5 bg-accent text-white font-bold rounded-full hover:bg-blue-600 transition shadow-lg shadow-blue-500/30 flex items-center">
                            Daftar Sekarang <i class="fa-solid fa-arrow-right ml-2"></i>
                        </a>
                        <a href="#profil" class="px-8 py-3.5 bg-white/10 text-white font-bold rounded-full hover:bg-white/20 transition backdrop-blur-md border border-white/20">
                            Profil Sekolah
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: KEPALA SEKOLAH (New) -->
        <section class="py-16 bg-white relative overflow-hidden" id="profil">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row items-center gap-10">
                    <div class="md:w-1/3 relative group">
                        <div class="absolute inset-0 bg-accent rounded-2xl rotate-3 opacity-20 group-hover:rotate-6 transition"></div>
                        <img id="ks-foto" src="https://via.placeholder.com/300x400" alt="Kepala Sekolah" class="relative rounded-2xl shadow-xl w-full object-cover h-[400px] border-4 border-white bg-slate-200">
                        <div class="absolute bottom-4 left-4 right-4 bg-white/90 backdrop-blur p-4 rounded-xl shadow-lg border border-slate-100">
                            <h4 id="ks-nama" class="text-lg font-bold text-primary">Kepala Sekolah</h4>
                            <p class="text-sm text-accent font-medium">Kepala Sekolah</p>
                        </div>
                    </div>
                    <div class="md:w-2/3">
                        <h3 class="text-accent font-bold tracking-wider uppercase mb-2">Sambutan Kepala Sekolah</h3>
                        <h2 class="text-3xl font-bold text-primary mb-6">Assalamu'alaikum Warahmatullahi Wabarakatuh</h2>
                        <div class="prose prose-lg text-slate-600 mb-6">
                            <p id="ks-sambutan" class="italic">"Selamat datang di website resmi kami. Melalui media ini, kami berharap dapat memberikan informasi yang transparan dan menjalin komunikasi yang lebih baik dengan masyarakat."</p>
                        </div>
                        <div class="mt-4 pt-4 border-t border-slate-200">
                            <p class="font-bold text-primary">Visi Sekolah:</p>
                            <p id="sekolah-visi" class="text-slate-600 text-sm mt-1">-</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: DATA UTAMA -->
        <section class="py-12 bg-slate-50 border-y border-slate-200">
            <div class="max-w-7xl mx-auto px-4 grid grid-cols-2 md:grid-cols-4 gap-6 text-center">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                    <div class="w-12 h-12 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center mx-auto mb-4 text-2xl">
                        <i class="fa-solid fa-users"></i>
                    </div>
                    <h3 id="stat-siswa" class="text-3xl font-bold text-primary mb-1">0</h3>
                    <p class="text-sm text-slate-500 font-medium">Siswa Aktif</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                    <div class="w-12 h-12 bg-emerald-100 text-emerald-600 rounded-xl flex items-center justify-center mx-auto mb-4 text-2xl">
                        <i class="fa-solid fa-chalkboard-user"></i>
                    </div>
                    <h3 id="stat-guru" class="text-3xl font-bold text-primary mb-1">0</h3>
                    <p class="text-sm text-slate-500 font-medium">Guru & Staff</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                    <div class="w-12 h-12 bg-purple-100 text-purple-600 rounded-xl flex items-center justify-center mx-auto mb-4 text-2xl">
                        <i class="fa-solid fa-building"></i>
                    </div>
                    <h3 id="stat-kelas" class="text-3xl font-bold text-primary mb-1">0</h3>
                    <p class="text-sm text-slate-500 font-medium">Ruang Kelas</p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition">
                    <div class="w-12 h-12 bg-orange-100 text-orange-600 rounded-xl flex items-center justify-center mx-auto mb-4 text-2xl">
                        <i class="fa-solid fa-trophy"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-primary mb-1">A</h3>
                    <p class="text-sm text-slate-500 font-medium">Akreditasi</p>
                </div>
            </div>
        </section>

        <!-- SECTION: BERITA -->
        <section id="berita" class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-end mb-12">
                    <div>
                        <h2 class="text-3xl font-bold text-primary mb-2">Berita Terbaru</h2>
                        <p class="text-slate-500">Kabar terkini dari sekolah kami</p>
                    </div>
                    <div id="admin-berita-btn" class="hidden">
                        <button onclick="openAdminModal('berita')" class="px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm hover:bg-emerald-600">
                            <i class="fa-solid fa-plus mr-1"></i> Tambah Berita
                        </button>
                    </div>
                </div>
                <div id="berita-list" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Berita items rendered here -->
                </div>
            </div>
        </section>

        <!-- SECTION: GURU -->
        <section id="guru" class="py-20 bg-slate-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center mb-12">
                    <div class="text-center w-full md:w-auto md:text-left">
                        <h2 class="text-3xl font-bold text-primary">Dewan Guru</h2>
                        <p class="text-slate-500 mt-2">Pendidik profesional yang berdedikasi</p>
                    </div>
                    <div id="admin-guru-btn" class="hidden">
                        <button onclick="openAdminModal('guru')" class="px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm hover:bg-emerald-600">
                            <i class="fa-solid fa-plus mr-1"></i> Kelola Guru
                        </button>
                    </div>
                </div>
                <div id="guru-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Guru items rendered here -->
                </div>
            </div>
        </section>

        <!-- SECTION: GALERI -->
        <section id="galeri" class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h2 class="text-3xl font-bold text-primary mb-2">Galeri Sekolah</h2>
                <div id="admin-galeri-btn" class="hidden mb-4">
                    <button onclick="openAdminModal('galeri')" class="px-4 py-2 bg-emerald-500 text-white rounded-lg text-sm">
                        <i class="fa-solid fa-plus mr-1"></i> Tambah Foto/Banner
                    </button>
                </div>
                <div id="galeri-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                    <!-- Galeri items -->
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="bg-primary text-white pt-16 pb-8">
            <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-12 mb-12">
                <div>
                    <h3 class="text-xl font-bold mb-4">SDN 4 Taman</h3>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6" id="footer-alamat">
                        Jalan Narasoma No.1, Taman, Kec.Taman, Kab. Pemalang, Jateng.
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" id="footer-fb" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-accent transition"><i class="fa-brands fa-facebook-f"></i></a>
                        <a href="#" id="footer-ig" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-rose-500 transition"><i class="fa-brands fa-instagram"></i></a>
                        <a href="#" id="footer-yt" class="w-10 h-10 rounded-full bg-slate-800 flex items-center justify-center hover:bg-red-600 transition"><i class="fa-brands fa-youtube"></i></a>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Tautan Cepat</h3>
                    <ul class="space-y-3 text-sm text-slate-400">
                        <li><a href="#profil" class="hover:text-white transition">Profil Sekolah</a></li>
                        <li><a href="#ppdb" class="hover:text-white transition">Info PPDB</a></li>
                        <li><a href="#download" class="hover:text-white transition">Download Dokumen</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-bold mb-4">Lokasi</h3>
                    <div class="rounded-xl overflow-hidden h-40 bg-slate-800" id="maps-container">
                        <!-- Maps Embed -->
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 text-center text-sm text-slate-500">
                &copy; 2026 SDN 4 Taman. All rights reserved.
            </div>
        </footer>
    </main>

    <!-- ADMIN MODAL (Universal) -->
    <div id="modal-admin" class="fixed inset-0 bg-black/50 hidden z-[70] flex items-center justify-center backdrop-blur-sm">
        <div class="bg-white rounded-2xl w-full max-w-4xl h-[90vh] overflow-hidden shadow-2xl flex flex-col">
            <!-- Modal Header -->
            <div class="p-4 border-b flex justify-between items-center bg-slate-50">
                <h3 class="font-bold text-lg text-primary" id="modal-title">Admin Dashboard</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-red-100 hover:text-red-600 flex items-center justify-center transition">
                    <i class="fa-solid fa-times"></i>
                </button>
            </div>
            
            <!-- Modal Body with Tabs -->
            <div class="flex flex-1 overflow-hidden">
                <!-- Sidebar -->
                <div class="w-1/4 bg-slate-50 border-r p-4 space-y-2 overflow-y-auto">
                    <button onclick="switchTab('config')" class="tab-btn w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white active-tab">‚öôÔ∏è Konfigurasi</button>
                    <button onclick="switchTab('guru')" class="tab-btn w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white text-slate-600">üë®‚Äçüè´ Data Guru</button>
                    <button onclick="switchTab('berita')" class="tab-btn w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white text-slate-600">üì∞ Berita</button>
                    <button onclick="switchTab('galeri')" class="tab-btn w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white text-slate-600">üì∑ Galeri & Banner</button>
                    <button onclick="doLogout()" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 mt-8">üö™ Logout</button>
                </div>

                <!-- Content Area -->
                <div class="flex-1 p-6 overflow-y-auto bg-white" id="modal-content">
                    
                    <!-- TAB CONFIG -->
                    <div id="tab-config" class="tab-content">
                        <h4 class="font-bold mb-4">Pengaturan Website</h4>
                        <form onsubmit="saveConfig(event)" class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Nama Sekolah</label><input type="text" id="cfg-nama" class="w-full border p-2 rounded text-sm"></div>
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Running Text</label><input type="text" id="cfg-run" class="w-full border p-2 rounded text-sm"></div>
                                <div class="col-span-2"><label class="block text-xs font-bold text-slate-500 mb-1">Visi Sekolah</label><textarea id="cfg-visi" rows="2" class="w-full border p-2 rounded text-sm"></textarea></div>
                                <div class="col-span-2"><label class="block text-xs font-bold text-slate-500 mb-1">Sambutan Kepala Sekolah</label><textarea id="cfg-sambutan" rows="4" class="w-full border p-2 rounded text-sm"></textarea></div>
                                <div class="col-span-2"><label class="block text-xs font-bold text-slate-500 mb-1">Link Google Maps (Embed URL)</label><input type="text" id="cfg-maps" class="w-full border p-2 rounded text-sm"></div>
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Facebook URL</label><input type="text" id="cfg-fb" class="w-full border p-2 rounded text-sm"></div>
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Instagram URL</label><input type="text" id="cfg-ig" class="w-full border p-2 rounded text-sm"></div>
                                <div><label class="block text-xs font-bold text-slate-500 mb-1">Youtube URL</label><input type="text" id="cfg-yt" class="w-full border p-2 rounded text-sm"></div>
                            </div>
                            <button type="submit" class="bg-primary text-white px-6 py-2 rounded-lg text-sm font-bold hover:bg-slate-800">Simpan Perubahan</button>
                        </form>
                    </div>

                    <!-- TAB GURU (Dynamic CRUD) -->
                    <div id="tab-guru" class="tab-content hidden">
                        <div class="flex justify-between mb-4">
                            <h4 class="font-bold">Data Guru</h4>
                            <button onclick="editItem('guru', null)" class="text-xs bg-accent text-white px-3 py-1 rounded">Tambah Baru</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-slate-100"><tr><th class="p-2">ID</th><th class="p-2">Nama</th><th class="p-2">Mapel</th><th class="p-2">Aksi</th></tr></thead>
                                <tbody id="adm-list-guru"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- TAB BERITA -->
                    <div id="tab-berita" class="tab-content hidden">
                        <div class="flex justify-between mb-4">
                            <h4 class="font-bold">Daftar Berita</h4>
                            <button onclick="editItem('berita', null)" class="text-xs bg-accent text-white px-3 py-1 rounded">Tambah Berita</button>
                        </div>
                        <ul id="adm-list-berita" class="space-y-2"></ul>
                    </div>

                    <!-- TAB GALERI (Include Banner) -->
                    <div id="tab-galeri" class="tab-content hidden">
                        <div class="bg-blue-50 p-3 rounded mb-4 text-xs text-blue-800">
                            üí° Tips: Untuk membuat slider otomatis, pilih Tipe = <b>Banner</b> saat menambah data.
                        </div>
                        <div class="flex justify-between mb-4">
                            <h4 class="font-bold">Galeri & Banner</h4>
                            <button onclick="editItem('galeri', null)" class="text-xs bg-accent text-white px-3 py-1 rounded">Upload Baru</button>
                        </div>
                        <div id="adm-list-galeri" class="grid grid-cols-3 gap-2"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div id="modal-login" class="fixed inset-0 bg-black/80 hidden z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-sm w-full p-6 shadow-2xl relative">
            <button onclick="document.getElementById('modal-login').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold text-primary mb-1">Login Admin</h3>
            <p class="text-xs text-slate-500 mb-4">Masuk untuk mengelola konten website.</p>
            <form onsubmit="doLogin(event)">
                <input type="text" name="user" placeholder="Username" class="w-full border p-3 rounded-lg mb-3 text-sm" required>
                <input type="password" name="pass" placeholder="Password" class="w-full border p-3 rounded-lg mb-4 text-sm" required>
                <button type="submit" class="w-full bg-accent text-white font-bold py-3 rounded-lg hover:bg-blue-600 transition">Masuk</button>
            </form>
        </div>
    </div>

    <!-- FORM MODAL (Dynamic for Edit/Add) -->
    <div id="modal-form" class="fixed inset-0 bg-black/60 hidden z-[90] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl relative">
            <h3 id="form-title" class="font-bold text-lg mb-4">Edit Data</h3>
            <form id="dynamic-form" class="space-y-3">
                <!-- Inputs generated via JS -->
            </form>
            <div class="flex justify-end gap-2 mt-4">
                <button onclick="document.getElementById('modal-form').classList.add('hidden')" class="px-4 py-2 text-sm text-slate-500 hover:bg-slate-100 rounded">Batal</button>
                <button onclick="submitDynamicForm()" class="px-4 py-2 text-sm bg-primary text-white rounded hover:bg-slate-800">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx7X2qGgC1iT35yTz-yqD3Z123/exec'; // GANTI URL INI
        let rawData = {};
        let isAdmin = localStorage.getItem('isAdmin') === 'true';

        // --- INIT ---
        window.addEventListener('load', async () => {
            if(isAdmin) document.body.classList.add('admin-mode');
            await loadData();
            initSlider();
        });

        async function loadData() {
            try {
                // Di sini simulasi data (mock) sesuai permintaan file user
                // Pada production, ganti dengan: 
                // const res = await fetch(SCRIPT_URL + '?action=getPublicData');
                // const json = await res.json();
                
                // MOCK DATA BASED ON YOUR CSV UPLOADS
                const json = {
                    status: 'success',
                    config: {
                        NamaSekolah: "SD Negeri 04 Taman",
                        RunningText: "Selamat Datang di Website Resmi SD Negeri 04 Taman",
                        SambutanKS: "Pendidikan adalah senjata paling ampuh untuk mengubah dunia.",
                        Visi: "Terwujudnya Peserta Didik yang Bertaqwa, Cerdas, Unggul dalam presasi dan Berdaya Guna.",
                        GoogleMapsEmbed: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3960.9217349990363!2d109.4007788!3d-6.8999636",
                        BannerURL: "https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png"
                    },
                    guru: [
                        ["1","kepalasekolah","12345@","Tentrem Lestari, S.Pd.","","Kepala Sekolah","lestari@sekolah.sch.id","https://i.postimg.cc/Vs2v3Dcg/1-TENTREM-LESTARI-S-Pd.png"],
                        ["2","gurukls1a","12345@","Ita Khusnul Hidayah, S.Pd.","","Guru kelas 1A","ita@sekolah.sch.id","https://i.postimg.cc/VNTPdZgx/4-ITA-KHUSNUL-HIDAYAH-S-Pd.jpg"],
                        ["3","gurukls1b","12345@","Indri Nurmala sari, S.Pd.","","Guru Kelas 1B","indri@sekolah.sch.id","https://i.postimg.cc/wTVKhjF2/11-INDRI-NURMALASARI-S-Pd.jpg"],
                        ["4","gurukls2a","12345@","Uci Apriliyani, S.Pd.","","Guru Kelas 2A","uci@sekolah.sch.id","https://i.postimg.cc/Y065Dr7r/7-UCI-APRILIYANI-S-Pd.jpg"],
                        ["5","gurukls2b","12345@","Dina Nur Afiyah, S.Pd.","","Guru Kelas 2B","Dina@sekolah.sch.id","https://i.postimg.cc/PxWLyDCL/Whats-App-Image.jpg"],
                        ["6","gurukls3a","12345@","Kharis Budi Santoso, S.Pd.","","Guru Kelas 3A","kharis@sekolah.sch.id","https://i.postimg.cc/FFqSMMtg/Gemini-Generated-Image-z2460z2460z2460z.png"],
                        ["7","gurukls3b","12345@","Yenining Tiyas, S.Pd.","","Guru Kelas 3B","Yeni@sekolah.sch.id","https://i.postimg.cc/sxs6XpFB/6-YENINING-TIYAS-S-Pd.jpg"],
                        ["8","gurukls4a","12345@","Nuryasih, S.Pd.","","Guru Kelas 4A","Asih@sekolah.sch.id","https://i.postimg.cc/q7N9VX0V/2-NURYASIH-S-Pd.png"],
                        ["9","gurukls4b","12345@","Bayu Prahastian, S.Pd.","199601212025211014","Guru Kelas 4B","bayu@sekolah.sch.id","https://i.postimg.cc/XYRgqwdv/12-BAYU-PRAHASTIAN-S-Pd.jpg"],
                        ["10","gurukls5a","12345@","Idhi Agung Mulyawan, S.Pd.","","Guru Kelas 5A","idhi@sekolah.sch.id","https://i.postimg.cc/zfHPPzSJ/5-IDHI-AGUNG-MULYAWAN-S-Pd.jpg"]
                    ],
                    berita: [
                        ["Selamat Datang", "06/02/2026 22:47:26", "Website resmi sekolah telah diluncurkan.", "https://via.placeholder.com/600x400"]
                    ],
                    galeri: [
                        ["Foto", "Kegiatan 1", "https://via.placeholder.com/300"],
                        ["Banner", "Slider 1", "https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png"],
                        ["Video", "Profil Sekolah", "https://drive.google.com/file/d/1Q8Rh37RCM7ULwx55jqfAQrxGYjXuZGgT/view?usp=sharing"]
                    ]
                };
                
                rawData = json;
                renderContent(json);
                document.getElementById('loading').classList.add('hidden');
                checkAdminUI();
            } catch (e) {
                console.error(e);
                alert("Gagal memuat data. Periksa koneksi internet.");
            }
        }

        // --- RENDER FUNCTIONS ---
        function renderContent(d) {
            const c = d.config;
            // Config Dasar
            document.title = c.NamaSekolah || "Website Sekolah";
            document.getElementById('nav-nama-sekolah').innerText = c.NamaSekolah;
            document.getElementById('footer-alamat').innerText = c.Alamat || "Alamat Sekolah";
            if(c.LogoURL) document.getElementById('logo-container').innerHTML = `<img src="${c.LogoURL}" class="w-full h-full object-contain">`;
            
            // Medsos
            if(c.Facebook) document.getElementById('footer-fb').href = c.Facebook;
            if(c.Instagram) document.getElementById('footer-ig').href = c.Instagram;
            if(c.Youtube) document.getElementById('footer-yt').href = c.Youtube;
            if(c.GoogleMapsEmbed) document.getElementById('maps-container').innerHTML = `<iframe src="${c.GoogleMapsEmbed}" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>`;

            // Kepala Sekolah (Cari di Data Guru yg Mapel-nya Kepala Sekolah)
            const ks = d.guru.find(g => g[5] && g[5].toLowerCase().includes('kepala sekolah'));
            if(ks) {
                document.getElementById('ks-nama').innerText = ks[3];
                document.getElementById('ks-foto').src = ks[7] || "https://via.placeholder.com/300x400";
            }
            if(c.SambutanKS) document.getElementById('ks-sambutan').innerText = `"${c.SambutanKS}"`;
            if(c.Visi) document.getElementById('sekolah-visi').innerText = c.Visi;

            // Statistik
            document.getElementById('stat-guru').innerText = d.guru.length;
            // Hitung siswa dari CSV siswa (disimulasikan 0 jika belum diload)
            document.getElementById('stat-siswa').innerText = "280"; // Mockup total

            // Berita
            const bList = document.getElementById('berita-list');
            bList.innerHTML = d.berita.map((b) => `
                <div class="bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-lg transition border border-slate-100 group">
                    <div class="h-48 overflow-hidden">
                        <img src="${b[3] || 'https://via.placeholder.com/400x200'}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                    </div>
                    <div class="p-6">
                        <span class="text-xs font-bold text-accent bg-blue-50 px-2 py-1 rounded">${b[1].split(' ')[0]}</span>
                        <h3 class="font-bold text-lg mt-2 mb-2 line-clamp-2 text-primary">${b[0]}</h3>
                        <p class="text-sm text-slate-500 line-clamp-3 mb-4">${b[2]}</p>
                    </div>
                </div>
            `).join('');

            // Guru
            const gGrid = document.getElementById('guru-grid');
            gGrid.innerHTML = d.guru.map(g => `
                <div class="bg-white rounded-xl p-4 text-center shadow-sm hover:shadow-md transition border border-slate-100">
                    <img src="${g[7] || 'https://via.placeholder.com/150'}" class="w-24 h-24 rounded-full mx-auto mb-3 object-cover border-2 border-slate-100 bg-slate-200">
                    <h4 class="font-bold text-primary text-sm">${g[3]}</h4>
                    <p class="text-xs text-slate-500">${g[5]}</p>
                </div>
            `).join('');

            // Galeri & Slider Logic
            const banners = d.galeri.filter(x => x[0] === 'Banner');
            const fotos = d.galeri.filter(x => x[0] !== 'Banner' && x[0] !== 'Video');
            
            // Render Galeri Grid (Hanya Foto)
            document.getElementById('galeri-grid').innerHTML = fotos.map(f => `
                <a href="${f[2]}" target="_blank" class="block aspect-square rounded-lg overflow-hidden relative group">
                    <img src="${f[2]}" class="w-full h-full object-cover group-hover:scale-110 transition">
                    <div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 flex items-center justify-center transition">
                        <p class="text-white text-xs font-bold text-center px-2">${f[1]}</p>
                    </div>
                </a>
            `).join('');

            // Render Slider
            const bannerContainer = document.getElementById('banner-container');
            if(banners.length > 0) {
                bannerContainer.innerHTML = banners.map((b, i) => `
                    <div class="absolute inset-0 bg-cover bg-center transition-fade ${i===0?'slide-active':'slide-hidden'} slide-item" style="background-image: url('${b[2]}');">
                        <div class="absolute inset-0 bg-gradient-to-t from-primary/90 via-primary/40 to-transparent"></div>
                    </div>
                `).join('');
            } else {
                if(c.BannerURL) document.getElementById('default-banner').style.backgroundImage = `url('${c.BannerURL}')`;
            }
        }

        function initSlider() {
            const slides = document.querySelectorAll('.slide-item');
            if(slides.length < 2) return;
            let current = 0;
            setInterval(() => {
                slides[current].classList.remove('slide-active');
                slides[current].classList.add('slide-hidden');
                current = (current + 1) % slides.length;
                slides[current].classList.remove('slide-hidden');
                slides[current].classList.add('slide-active');
            }, 5000);
        }

        // --- ADMIN & CRUD LOGIC ---
        function openLogin() {
            if(isAdmin) { openAdminModal('config'); return; }
            document.getElementById('modal-login').classList.remove('hidden');
        }

        async function doLogin(e) {
            e.preventDefault();
            const u = e.target.user.value;
            const p = e.target.pass.value;
            // Simple check (Untuk produksi gunakan API check)
            if(u === 'admin' && p === 'admin123') { 
                localStorage.setItem('isAdmin', 'true');
                isAdmin = true;
                location.reload();
            } else {
                alert("Password Salah!");
            }
        }

        function doLogout() {
            localStorage.removeItem('isAdmin');
            location.reload();
        }

        function checkAdminUI() {
            if(!isAdmin) return;
            document.getElementById('btn-login').innerHTML = `<i class="fa-solid fa-user-gear mr-2"></i>Admin Panel`;
            document.getElementById('admin-berita-btn').classList.remove('hidden');
            document.getElementById('admin-guru-btn').classList.remove('hidden');
            document.getElementById('admin-galeri-btn').classList.remove('hidden');
        }

        function openAdminModal(tab) {
            if(!isAdmin) return;
            document.getElementById('modal-admin').classList.remove('hidden');
            switchTab(tab);
        }

        function closeModal() {
            document.getElementById('modal-admin').classList.add('hidden');
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            
            if(tabName === 'config') {
                const c = rawData.config;
                document.getElementById('cfg-nama').value = c.NamaSekolah || '';
                document.getElementById('cfg-run').value = c.RunningText || '';
                document.getElementById('cfg-sambutan').value = c.SambutanKS || '';
                document.getElementById('cfg-visi').value = c.Visi || '';
                document.getElementById('cfg-maps').value = c.GoogleMapsEmbed || '';
                document.getElementById('cfg-fb').value = c.Facebook || '';
                document.getElementById('cfg-ig').value = c.Instagram || '';
                document.getElementById('cfg-yt').value = c.Youtube || '';
            }
            if(tabName === 'guru') {
                document.getElementById('adm-list-guru').innerHTML = rawData.guru.map(g => `
                    <tr class="border-b hover:bg-slate-50">
                        <td class="p-2 text-xs font-mono">${g[0]}</td>
                        <td class="p-2">${g[3]}</td>
                        <td class="p-2 text-xs text-slate-500">${g[5]}</td>
                        <td class="p-2">
                            <button onclick="editItem('guru', '${g[0]}')" class="text-blue-500 hover:text-blue-700 mr-2"><i class="fa-solid fa-edit"></i></button>
                            <button onclick="deleteItem('Guru', '${g[0]}')" class="text-red-500 hover:text-red-700"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `).join('');
            }
            if(tabName === 'galeri') {
                document.getElementById('adm-list-galeri').innerHTML = rawData.galeri.map(g => `
                    <div class="relative group border rounded overflow-hidden">
                        <img src="${g[2]}" class="w-full h-24 object-cover">
                        <div class="absolute top-0 right-0 bg-black/50 text-white text-xs p-1">${g[0]}</div>
                        <div class="absolute bottom-0 left-0 w-full bg-white/90 text-xs p-1 truncate">${g[1]}</div>
                        <button onclick="deleteItem('Galeri', '${g[2]}')" class="absolute top-1 left-1 bg-red-600 text-white w-6 h-6 rounded-full text-xs flex items-center justify-center"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `).join('');
            }
        }

        // --- NEW AUTO ID LOGIC ---
        function getNextID() {
            // Ambil semua ID dari data guru (Kolom ke-0)
            const ids = rawData.guru.map(g => parseInt(g[0])).filter(n => !isNaN(n));
            
            if (ids.length === 0) return 1; // Jika kosong, mulai dari 1
            const max = Math.max(...ids);
            return max + 1; // ID Terakhir + 1
        }

        // --- DYNAMIC FORM HANDLER ---
        let currentEditType = '';
        let currentEditId = null;

        function editItem(type, id) {
            currentEditType = type;
            currentEditId = id;
            const modal = document.getElementById('modal-form');
            const form = document.getElementById('dynamic-form');
            document.getElementById('form-title').innerText = id ? 'Edit Data' : 'Tambah Data Baru';
            modal.classList.remove('hidden');
            form.innerHTML = ''; 

            if(type === 'guru') {
                // Jika ID null (Tambah Baru), Generate ID Urut. Jika Edit, pakai ID lama.
                const nextId = id ? id : getNextID();
                const data = id ? rawData.guru.find(g => g[0] == id) : [nextId, '', '', '', '', '', '', ''];
                
                form.innerHTML = `
                    <div class="bg-blue-50 p-2 rounded mb-2 text-xs text-blue-800">
                        ID Guru: <b>${data[0]}</b> (Otomatis)
                    </div>
                    <input type="hidden" id="f-id" value="${data[0]}">
                    <input type="text" id="f-nama" value="${data[3]||''}" placeholder="Nama Lengkap (Gelar)" class="w-full border p-2 rounded text-sm" required>
                    <input type="text" id="f-nip" value="${data[4]||''}" placeholder="NIP (Boleh Kosong)" class="w-full border p-2 rounded text-sm">
                    <input type="text" id="f-mapel" value="${data[5]||''}" placeholder="Jabatan / Kelas (Cth: Guru Kelas 1A)" class="w-full border p-2 rounded text-sm" required>
                    <input type="text" id="f-foto" value="${data[7]||''}" placeholder="URL Foto (https://...)" class="w-full border p-2 rounded text-sm">
                    <p class="text-xs text-slate-400">Gunakan link gambar langsung (cth: postimg.cc)</p>
                `;
            }
            if(type === 'berita') {
                form.innerHTML = `
                    <input type="text" id="f-judul" placeholder="Judul Berita" class="w-full border p-2 rounded text-sm" required>
                    <textarea id="f-isi" placeholder="Isi Berita" class="w-full border p-2 rounded text-sm" rows="5"></textarea>
                    <input type="text" id="f-foto" placeholder="URL Foto Utama" class="w-full border p-2 rounded text-sm">
                `;
            }
            if(type === 'galeri') {
                form.innerHTML = `
                    <label class="block text-xs font-bold text-slate-500">Tipe Konten</label>
                    <select id="f-tipe" class="w-full border p-2 rounded text-sm mb-2">
                        <option value="Foto">Foto Dokumentasi</option>
                        <option value="Banner">Banner Slider (Atas)</option>
                        <option value="Video">Video</option>
                    </select>
                    <input type="text" id="f-judul" placeholder="Judul/Keterangan" class="w-full border p-2 rounded text-sm">
                    <input type="text" id="f-link" placeholder="URL Gambar/Video" class="w-full border p-2 rounded text-sm" required>
                `;
            }
        }

        async function submitDynamicForm() {
            const f = document.getElementById('dynamic-form');
            let payload = {};
            let sheetName = '';
            let rowId = currentEditId;

            if(currentEditType === 'guru') {
                sheetName = 'Guru';
                const id = document.getElementById('f-id').value;
                // Format CSV: ID,Username,Password,Nama,NIP,Mapel,Email,FotoURL
                payload = [
                    id, 
                    `guru${id}`, 
                    '12345@', 
                    document.getElementById('f-nama').value, 
                    document.getElementById('f-nip').value, 
                    document.getElementById('f-mapel').value, 
                    '', 
                    document.getElementById('f-foto').value
                ];
                rowId = id; 
            }
            else if(currentEditType === 'berita') {
                sheetName = 'Berita';
                const now = new Date().toLocaleString();
                // Judul, Tanggal, Isi, Foto
                payload = [document.getElementById('f-judul').value, now, document.getElementById('f-isi').value, document.getElementById('f-foto').value];
                rowId = null; 
            }
            else if(currentEditType === 'galeri') {
                sheetName = 'Galeri';
                // Tipe, Judul, Link
                payload = [document.getElementById('f-tipe').value, document.getElementById('f-judul').value, document.getElementById('f-link').value];
            }

            // SIMULASI SAVE (Aktifkan baris bawah ini untuk production)
            // await postAPI('saveGeneral', { sheet: sheetName, id: rowId, data: payload });
            
            console.log("Saving to", sheetName, payload);
            alert("Data Disimpan! (Silakan Reload untuk melihat perubahan)");
            location.reload();
        }

        async function saveConfig(e) {
            e.preventDefault();
            const d = {
                NamaSekolah: document.getElementById('cfg-nama').value,
                RunningText: document.getElementById('cfg-run').value,
                SambutanKS: document.getElementById('cfg-sambutan').value,
                Visi: document.getElementById('cfg-visi').value,
                GoogleMapsEmbed: document.getElementById('cfg-maps').value,
                Facebook: document.getElementById('cfg-fb').value,
                Instagram: document.getElementById('cfg-ig').value,
                Youtube: document.getElementById('cfg-yt').value,
            };
            // await postAPI('saveConfig', { data: d });
            console.log("Config Saved", d);
            alert("Konfigurasi Disimpan!");
        }

        async function postAPI(action, data) {
            try {
                const res = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ action, ...data })
                });
                return await res.json();
            } catch(e) {
                alert("Gagal menghubungi server");
            }
        }
        
        async function deleteItem(sheet, id) {
            if(!confirm("Yakin ingin menghapus data ini?")) return;
            // await postAPI('deleteGeneral', { sheet: sheet, id: id });
            alert("Data dihapus!");
            location.reload();
        }

    </script>
</body>
</html>