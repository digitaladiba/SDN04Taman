<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Informasi Digital SDN 4 Taman</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { 
                        primary: '#0f172a', 
                        accent: '#2563eb', 
                        gold: '#fbbf24',
                        emerald: '#10b981',
                        rose: '#f43f5e'
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .slide-active { opacity: 1; z-index: 10; }
        .slide-hidden { opacity: 0; z-index: 0; }
        .transition-fade { transition: opacity 1s ease-in-out; }
        html { scroll-behavior: smooth; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-accent selection:text-white">

    <!-- NAVBAR -->
    <nav class="fixed w-full z-50 glass-nav border-b border-slate-200 transition-all duration-300 shadow-sm" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <!-- LOGO & NAMA -->
                <div class="flex items-center gap-3">
                    <img id="nav-logo" src="https://i.postimg.cc/CxkhTg41/Whats-App-Image-2025-03-06-at-09-04-17-removebg-preview.png" alt="Logo" class="h-12 w-auto object-contain">
                    <div class="leading-tight">
                        <h1 id="nav-nama-sekolah" class="text-xl font-bold text-primary">SDN 4 Taman</h1>
                        <p class="text-[10px] md:text-xs text-slate-500 font-bold tracking-widest uppercase">Berkarakter & Berprestasi</p>
                    </div>
                </div>
                
                <!-- DESKTOP MENU -->
                <div class="hidden lg:flex space-x-6 items-center">
                    <a href="#beranda" class="text-sm font-semibold text-slate-600 hover:text-accent transition">Beranda</a>
                    <div class="relative group">
                        <button class="text-sm font-semibold text-slate-600 hover:text-accent flex items-center gap-1 py-4">Profil <i class="fa-solid fa-chevron-down text-xs"></i></button>
                        <div class="absolute top-full left-0 w-56 bg-white border border-slate-100 shadow-xl rounded-xl p-2 hidden group-hover:block animate-fade-in z-50">
                            <a href="#sambutan" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Sambutan KS</a>
                            <a href="#visi-misi" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Visi & Misi</a>
                            <a href="#guru" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Guru & Staff</a>
                            <a href="#sotk" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Struktur Organisasi</a>
                        </div>
                    </div>
                    <div class="relative group">
                        <button class="text-sm font-semibold text-slate-600 hover:text-accent flex items-center gap-1 py-4">Data <i class="fa-solid fa-chevron-down text-xs"></i></button>
                        <div class="absolute top-full left-0 w-56 bg-white border border-slate-100 shadow-xl rounded-xl p-2 hidden group-hover:block animate-fade-in z-50">
                            <a href="#data-siswa" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Data Siswa</a>
                            <a href="#mutasi" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Mutasi Siswa</a>
                        </div>
                    </div>
                    <a href="#fasilitas" class="text-sm font-semibold text-slate-600 hover:text-accent transition">Fasilitas</a>
                    <a href="#download" class="text-sm font-semibold text-slate-600 hover:text-accent transition">Download</a>
                    <a href="#berita" class="text-sm font-semibold text-slate-600 hover:text-accent transition">Berita</a>
                    
                    <!-- LMS Button -->
                    <a href="#" id="btn-lms" target="_blank" class="px-4 py-2 bg-orange-500 text-white text-sm font-bold rounded-lg hover:bg-orange-600 transition shadow-lg shadow-orange-500/20">
                        <i class="fa-solid fa-laptop-code mr-2"></i>LMS
                    </a>

                    <button onclick="openLogin()" id="btn-login" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-accent hover:text-white flex items-center justify-center transition shadow-sm border border-slate-200">
                        <i class="fa-solid fa-lock text-xs"></i>
                    </button>
                </div>

                <!-- MOBILE MENU BTN -->
                <button onclick="toggleMobileMenu()" class="lg:hidden text-slate-600 text-2xl"><i class="fa-solid fa-bars"></i></button>
            </div>
        </div>
        
        <!-- MOBILE MENU -->
        <div id="mobile-menu" class="hidden lg:hidden bg-white border-t p-4 space-y-3 shadow-xl max-h-[80vh] overflow-y-auto">
            <a href="#beranda" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Beranda</a>
            <a href="#sambutan" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Profil & Sambutan</a>
            <a href="#guru" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Data Guru</a>
            <a href="#data-siswa" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Data Siswa</a>
            <a href="#fasilitas" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Fasilitas</a>
            <a href="#download" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Download</a>
            <a href="#lms-mobile" id="lms-mobile-link" class="block font-bold text-orange-500 p-2 bg-orange-50 rounded text-center mt-4">Akses LMS</a>
            <button onclick="openLogin()" class="w-full text-center font-bold text-slate-500 p-2 border border-slate-200 rounded mt-2">Login Admin</button>
        </div>
    </nav>

    <!-- LOADING SCREEN (Failsafe added) -->
    <div id="loading" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-16 h-16 border-4 border-slate-200 border-t-accent rounded-full animate-spin mb-4"></div>
        <p class="text-slate-500 font-medium animate-pulse">Memuat Data Sekolah...</p>
        <p class="text-xs text-slate-400 mt-2">(Jika macet, halaman akan terbuka otomatis dalam 3 detik)</p>
    </div>

    <main class="pt-20">
        
        <!-- 1. HERO SLIDER -->
        <section id="beranda" class="relative w-full h-[500px] md:h-[650px] overflow-hidden bg-slate-900">
            <div id="banner-container" class="relative w-full h-full">
                <!-- Fallback Banner -->
                <div class="absolute inset-0 bg-cover bg-center transition-fade slide-active" id="default-banner" style="background-image: url('https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png');">
                    <div class="absolute inset-0 bg-black/50"></div>
                </div>
            </div>
            <div class="absolute inset-0 flex items-center justify-center z-20 text-center px-4">
                <div class="max-w-4xl animate-fade-in-up">
                    <span class="inline-block py-1 px-4 rounded-full bg-white/20 text-white backdrop-blur-md border border-white/30 text-xs font-bold mb-6">
                        OFFICIAL WEBSITE
                    </span>
                    <h2 class="text-4xl md:text-6xl font-extrabold text-white mb-6 leading-tight drop-shadow-lg" id="hero-title">
                        SD NEGERI 04 TAMAN
                    </h2>
                    <p class="text-slate-200 text-lg md:text-xl mb-8 max-w-2xl mx-auto drop-shadow-md" id="hero-desc">
                        Selamat Datang di Website Resmi SD Negeri 04 Taman. Berkarakter, Berprestasi, dan Berakhlak Mulia.
                    </p>
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <a href="#ppdb" class="px-8 py-3 bg-accent text-white font-bold rounded-full hover:bg-blue-600 transition shadow-lg shadow-accent/50">
                            <i class="fa-solid fa-user-plus mr-2"></i> Info PPDB
                        </a>
                        <a href="#profil" class="px-8 py-3 bg-white text-slate-900 font-bold rounded-full hover:bg-slate-100 transition shadow-lg">
                            <i class="fa-solid fa-school mr-2"></i> Profil Sekolah
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. SAMBUTAN KEPALA SEKOLAH -->
        <section id="sambutan" class="py-20 bg-white relative overflow-hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row items-center gap-12">
                    <div class="md:w-1/3 relative text-center md:text-left">
                        <div class="absolute inset-0 bg-accent/10 rounded-3xl rotate-6 transform hidden md:block"></div>
                        <img id="ks-foto" src="https://i.postimg.cc/Vs2v3Dcg/1-TENTREM-LESTARI-S-Pd.png" alt="Kepala Sekolah" class="relative rounded-3xl shadow-2xl w-full max-w-xs mx-auto md:max-w-full object-cover h-[450px] border-4 border-white bg-slate-200">
                        <div class="absolute -bottom-6 -right-6 bg-white p-4 rounded-xl shadow-lg border border-slate-100 text-center w-48 hidden md:block">
                            <p class="text-xs text-slate-500 font-bold uppercase tracking-wider mb-1">Kepala Sekolah</p>
                            <h4 id="ks-nama-badge" class="font-bold text-primary text-sm">Tentrem Lestari, S.Pd.</h4>
                        </div>
                    </div>
                    <div class="md:w-2/3">
                        <span class="text-accent font-bold tracking-wider uppercase text-sm mb-2 block">Sambutan Kepala Sekolah</span>
                        <h2 class="text-3xl md:text-4xl font-bold text-primary mb-6">Assalamu'alaikum Warahmatullahi Wabarakatuh</h2>
                        <div class="prose prose-lg text-slate-600 mb-6 italic border-l-4 border-accent pl-6 py-2 bg-slate-50 rounded-r-lg">
                            <p id="ks-sambutan">"Pendidikan adalah senjata paling ampuh untuk mengubah dunia. Mari bersinergi membangun karakter anak bangsa."</p>
                        </div>
                        <div id="ks-detail">
                            <h4 id="ks-nama" class="font-bold text-lg text-primary">Tentrem Lestari, S.Pd.</h4>
                            <p class="text-slate-500">NIP. <span id="ks-nip">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. VISI MISI & DATA UTAMA -->
        <section id="visi-misi" class="py-16 bg-slate-900 text-white relative">
            <div class="absolute top-0 right-0 w-64 h-64 bg-accent/10 rounded-full blur-3xl"></div>
            <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-12 relative z-10">
                <div>
                    <h3 class="text-2xl font-bold text-white mb-6 border-b border-slate-700 pb-4"><i class="fa-solid fa-star text-yellow-400 mr-2"></i> Visi Sekolah</h3>
                    <p id="visi-text" class="text-lg leading-relaxed text-slate-300 font-light">
                        "Terwujudnya Peserta Didik yang Bertaqwa, Cerdas, Unggul dalam prestasi dan Berdaya Guna."
                    </p>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-white mb-6 border-b border-slate-700 pb-4"><i class="fa-solid fa-list-check text-emerald-400 mr-2"></i> Misi Sekolah</h3>
                    <ul id="misi-list" class="space-y-3 text-slate-300 text-sm md:text-base">
                        <!-- JS populated -->
                        <li><i class="fa-solid fa-check text-emerald-400 mr-2"></i> Melaksanakan pembelajaran aktif, inovatif, kreatif, efektif dan menyenangkan.</li>
                        <li><i class="fa-solid fa-check text-emerald-400 mr-2"></i> Mengembangkan bakat dan minat siswa.</li>
                        <li><i class="fa-solid fa-check text-emerald-400 mr-2"></i> Menanamkan nilai-nilai karakter.</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 4. DATA SISWA & STATISTIK -->
        <section id="data-siswa" class="py-20 bg-slate-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-primary">Data Statistik Siswa</h2>
                    <p class="text-slate-500 mt-2">Rekapitulasi jumlah siswa per kelas Tahun Ajaran 2025/2026</p>
                </div>

                <!-- Statistik Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 text-center hover:shadow-md transition transform hover:-translate-y-1">
                        <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-3"><i class="fa-solid fa-users"></i></div>
                        <h3 id="total-siswa" class="text-3xl font-bold text-slate-800 mb-1">0</h3>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Total Siswa</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 text-center hover:shadow-md transition transform hover:-translate-y-1">
                        <div class="w-10 h-10 bg-slate-100 text-slate-600 rounded-full flex items-center justify-center mx-auto mb-3"><i class="fa-solid fa-person"></i></div>
                        <h3 id="total-lk" class="text-3xl font-bold text-slate-700 mb-1">0</h3>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Laki-Laki</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 text-center hover:shadow-md transition transform hover:-translate-y-1">
                        <div class="w-10 h-10 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center mx-auto mb-3"><i class="fa-solid fa-person-dress"></i></div>
                        <h3 id="total-pr" class="text-3xl font-bold text-pink-500 mb-1">0</h3>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Perempuan</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 text-center hover:shadow-md transition transform hover:-translate-y-1">
                        <div class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center mx-auto mb-3"><i class="fa-solid fa-layer-group"></i></div>
                        <h3 id="total-rombel" class="text-3xl font-bold text-emerald-600 mb-1">0</h3>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Rombel</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-3 gap-8">
                    <!-- Table Detail -->
                    <div class="md:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="p-4 border-b bg-slate-50 font-bold text-primary flex justify-between items-center">
                            <span>Rincian Per Kelas</span>
                            <span class="text-xs bg-accent/10 text-accent px-2 py-1 rounded">Update Terbaru</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left">
                                <thead class="bg-slate-100 text-slate-600 uppercase text-xs font-bold">
                                    <tr>
                                        <th class="p-4">Kelas</th>
                                        <th class="p-4 text-center">Laki-Laki</th>
                                        <th class="p-4 text-center">Perempuan</th>
                                        <th class="p-4 text-center bg-slate-200">Jumlah</th>
                                    </tr>
                                </thead>
                                <tbody id="siswa-tbody" class="divide-y divide-slate-100">
                                    <!-- JS Load -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Chart -->
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 flex flex-col items-center justify-center">
                        <h4 class="font-bold text-sm mb-6 text-slate-500 uppercase tracking-wider">Komposisi Gender</h4>
                        <div class="w-full max-w-[200px] aspect-square relative">
                            <canvas id="genderChart"></canvas>
                        </div>
                        <div class="flex gap-4 mt-6 text-xs font-bold">
                            <div class="flex items-center gap-2"><span class="w-3 h-3 bg-slate-800 rounded-full"></span> Laki-Laki</div>
                            <div class="flex items-center gap-2"><span class="w-3 h-3 bg-pink-500 rounded-full"></span> Perempuan</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. MUTASI SISWA -->
        <section id="mutasi" class="py-16 bg-white border-y border-slate-100">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-primary">Data Mutasi Siswa</h2>
                        <p class="text-sm text-slate-500">Rekapitulasi keluar masuk siswa</p>
                    </div>
                    <span class="text-xs bg-orange-100 text-orange-600 px-3 py-1 rounded-full font-bold">Semester Ini</span>
                </div>
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-center">
                            <thead class="bg-primary text-white">
                                <tr>
                                    <th rowspan="2" class="p-3 border-r border-slate-700 w-1/5">Kelas</th>
                                    <th colspan="2" class="p-2 border-b border-slate-700 bg-emerald-600">Masuk</th>
                                    <th colspan="2" class="p-2 border-b border-slate-700 bg-rose-600">Keluar</th>
                                </tr>
                                <tr>
                                    <th class="p-2 bg-emerald-700 w-1/5">L</th>
                                    <th class="p-2 bg-emerald-700 w-1/5">P</th>
                                    <th class="p-2 bg-rose-700 w-1/5">L</th>
                                    <th class="p-2 bg-rose-700 w-1/5">P</th>
                                </tr>
                            </thead>
                            <tbody id="mutasi-tbody" class="divide-y">
                                <!-- Loaded by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. GURU & STAFF -->
        <section id="guru" class="py-20 bg-slate-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-primary">Dewan Guru & Staff</h2>
                    <p class="text-slate-500 mt-2">Pendidik profesional yang berdedikasi</p>
                </div>
                <div id="guru-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6">
                    <!-- JS Loaded -->
                </div>
                
                <!-- SOTK / Struktur -->
                <div id="sotk" class="mt-16 bg-white p-8 rounded-2xl shadow-sm border border-slate-200 text-center">
                    <h3 class="text-xl font-bold mb-6">Struktur Organisasi Sekolah (SOTK)</h3>
                    <div class="p-6 bg-slate-50 rounded-xl border border-slate-200">
                        <p class="text-slate-500 italic mb-4">Struktur Organisasi Tahun Ajaran 2025/2026</p>
                        <!-- Placeholder for SOTK Image -->
                        <div class="flex flex-col items-center justify-center space-y-4">
                            <div class="w-64 p-4 bg-white border border-accent rounded shadow text-center font-bold text-primary">Kepala Sekolah<br><span class="text-xs font-normal">Tentrem Lestari, S.Pd.</span></div>
                            <div class="h-8 w-0.5 bg-slate-300"></div>
                            <div class="flex gap-8 flex-wrap justify-center">
                                <div class="w-40 p-2 bg-white border border-slate-300 rounded shadow text-center text-xs">Komite Sekolah</div>
                                <div class="w-40 p-2 bg-white border border-slate-300 rounded shadow text-center text-xs">Tata Usaha</div>
                            </div>
                            <div class="h-8 w-0.5 bg-slate-300"></div>
                            <div class="w-64 p-2 bg-white border border-slate-300 rounded shadow text-center font-bold text-sm">Dewan Guru</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. FASILITAS & EKSTRA -->
        <section id="fasilitas" class="py-20 bg-white">
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-primary">Fasilitas & Ekstrakurikuler</h2>
                    <p class="text-slate-500 mt-2">Menunjang bakat dan minat siswa</p>
                </div>
                
                <!-- Tabs -->
                <div class="flex justify-center gap-2 mb-8 flex-wrap">
                    <button onclick="filterFasilitas('all')" class="filter-btn px-6 py-2 rounded-full bg-primary text-white text-sm font-bold shadow-lg transition transform hover:scale-105 active-filter">Semua</button>
                    <button onclick="filterFasilitas('Sapras')" class="filter-btn px-6 py-2 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 text-sm font-bold transition">Sarana Prasarana</button>
                    <button onclick="filterFasilitas('Ekstrakulikuler')" class="filter-btn px-6 py-2 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 text-sm font-bold transition">Ekstrakurikuler</button>
                </div>

                <div id="fasilitas-grid" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- Loaded JS -->
                </div>
            </div>
        </section>

        <!-- 8. DOWNLOAD & BERITA -->
        <section class="py-20 bg-slate-50 border-t border-slate-200">
            <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-3 gap-12">
                
                <!-- Berita (2/3 width) -->
                <div class="md:col-span-2" id="berita">
                    <h3 class="text-2xl font-bold text-primary mb-6 flex items-center">
                        <i class="fa-regular fa-newspaper mr-3 text-accent"></i> Berita Terkini
                    </h3>
                    <div id="berita-list" class="space-y-6">
                        <!-- Loaded JS -->
                    </div>
                </div>

                <!-- Download & Sidebar (1/3 width) -->
                <div id="download">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-8 sticky top-24">
                        <h3 class="font-bold text-primary mb-4 flex items-center border-b pb-2">
                            <i class="fa-solid fa-download mr-2 text-emerald-500"></i> Download Area
                        </h3>
                        <ul id="download-list" class="space-y-3">
                            <!-- Loaded JS -->
                            <li class="text-slate-400 text-sm italic">Belum ada file.</li>
                        </ul>
                        
                        <!-- PPDB Widget -->
                        <div id="ppdb" class="mt-8 bg-gradient-to-br from-accent to-blue-600 rounded-2xl p-6 text-white text-center shadow-lg relative overflow-hidden group">
                            <div class="absolute top-0 right-0 w-24 h-24 bg-white/10 rounded-full -mr-12 -mt-12 blur-xl"></div>
                            <h3 class="font-bold text-xl mb-1">PPDB 2026/2027</h3>
                            <p class="text-blue-100 text-xs mb-4">Penerimaan Peserta Didik Baru</p>
                            <div class="bg-white/20 rounded px-2 py-1 inline-block text-xs font-bold mb-4 border border-white/20">
                                <span class="w-2 h-2 bg-green-400 rounded-full inline-block mr-1"></span> DIBUKA
                            </div>
                            <button onclick="document.getElementById('modal-spmb').classList.remove('hidden')" class="w-full bg-white text-accent font-bold py-3 rounded-lg hover:bg-blue-50 transition shadow-lg">
                                Daftar Sekarang
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER & MAPS -->
        <footer class="bg-primary text-white pt-16 pb-8 border-t-4 border-accent relative">
            <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-12 mb-12">
                <!-- Info -->
                <div>
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 bg-white text-primary rounded flex items-center justify-center font-bold text-xl"><i class="fa-solid fa-school"></i></div>
                        <h3 class="text-xl font-bold">SDN 4 Taman</h3>
                    </div>
                    <p class="text-slate-400 text-sm leading-relaxed mb-6">
                        <i class="fa-solid fa-location-dot mr-2 text-accent"></i> <span id="footer-alamat">Jalan Narasoma No.1, Taman, Kec.Taman, Kab. Pemalang, Jateng</span>
                    </p>
                    <p class="text-slate-400 text-sm mb-6">
                        <i class="fa-solid fa-envelope mr-2 text-accent"></i> <span id="footer-email">sdn04taman@gmail.com</span>
                    </p>
                    <div class="flex space-x-3">
                        <a href="#" class="w-10 h-10 rounded bg-slate-700 flex items-center justify-center hover:bg-[#1877F2] transition text-white"><i class="fa-brands fa-facebook-f"></i></a>
                        <a href="#" class="w-10 h-10 rounded bg-slate-700 flex items-center justify-center hover:bg-[#E4405F] transition text-white"><i class="fa-brands fa-instagram"></i></a>
                        <a href="#" class="w-10 h-10 rounded bg-slate-700 flex items-center justify-center hover:bg-[#FF0000] transition text-white"><i class="fa-brands fa-youtube"></i></a>
                    </div>
                </div>
                
                <!-- Links -->
                <div>
                    <h3 class="text-lg font-bold mb-6 text-white border-b border-slate-700 pb-2 inline-block">Tautan Cepat</h3>
                    <ul class="space-y-3 text-sm text-slate-400">
                        <li><a href="#profil" class="hover:text-accent transition flex items-center"><i class="fa-solid fa-chevron-right text-xs mr-2"></i> Profil Sekolah</a></li>
                        <li><a href="#data-siswa" class="hover:text-accent transition flex items-center"><i class="fa-solid fa-chevron-right text-xs mr-2"></i> Data Siswa</a></li>
                        <li><a href="#fasilitas" class="hover:text-accent transition flex items-center"><i class="fa-solid fa-chevron-right text-xs mr-2"></i> Fasilitas</a></li>
                        <li><a href="#" id="footer-lms" class="hover:text-accent transition flex items-center"><i class="fa-solid fa-chevron-right text-xs mr-2"></i> E-Learning (LMS)</a></li>
                    </ul>
                </div>

                <!-- Maps -->
                <div>
                    <h3 class="text-lg font-bold mb-6 text-white border-b border-slate-700 pb-2 inline-block">Lokasi Kami</h3>
                    <div class="rounded-xl overflow-hidden h-48 bg-slate-800 shadow-inner border border-slate-700 relative group" id="maps-container">
                        <!-- Embed Maps -->
                        <div class="absolute inset-0 flex items-center justify-center text-slate-500 text-xs">Memuat Peta...</div>
                    </div>
                </div>
            </div>
            <div class="border-t border-slate-800 pt-8 text-center text-sm text-slate-500">
                &copy; 2026 SDN 4 Taman. Created by Admin.
            </div>
        </footer>
    </main>

    <!-- ADMIN MODAL (CRUD) -->
    <div id="modal-admin" class="fixed inset-0 bg-black/50 hidden z-[70] flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white rounded-2xl w-full max-w-5xl h-[90vh] overflow-hidden shadow-2xl flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50">
                <h3 class="font-bold text-lg text-primary flex items-center"><i class="fa-solid fa-user-gear mr-2 text-accent"></i>Admin Dashboard</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-slate-200 hover:bg-red-100 hover:text-red-600 flex items-center justify-center transition"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="flex flex-1 overflow-hidden">
                <div class="w-64 bg-slate-50 border-r p-4 space-y-1 overflow-y-auto hidden md:block">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2 ml-2">Menu Utama</p>
                    <button onclick="switchTab('config')" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm text-slate-600 transition focus:bg-white focus:text-accent">‚öôÔ∏è Konfigurasi</button>
                    <button onclick="switchTab('guru')" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm text-slate-600 transition focus:bg-white focus:text-accent">üë®‚Äçüè´ Data Guru</button>
                    <button onclick="switchTab('siswa')" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm text-slate-600 transition focus:bg-white focus:text-accent">üéì Data Siswa</button>
                    <button onclick="switchTab('mutasi')" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm text-slate-600 transition focus:bg-white focus:text-accent">üìä Mutasi</button>
                    <button onclick="switchTab('fasilitas')" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm text-slate-600 transition focus:bg-white focus:text-accent">üè´ Fasilitas</button>
                    <button onclick="switchTab('berita')" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm text-slate-600 transition focus:bg-white focus:text-accent">üì∞ Berita</button>
                    <button onclick="switchTab('galeri')" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm text-slate-600 transition focus:bg-white focus:text-accent">üì∑ Galeri</button>
                    <button onclick="doLogout()" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium text-red-600 hover:bg-red-50 mt-8">üö™ Logout</button>
                </div>
                <div class="flex-1 p-6 overflow-y-auto bg-white relative" id="modal-content">
                    
                    <!-- CONFIG -->
                    <div id="tab-config" class="tab-content">
                        <h4 class="font-bold text-xl mb-6">Konfigurasi Website</h4>
                        <form onsubmit="saveWebConfig(event)" class="space-y-4 max-w-2xl">
                            <div><label class="lbl">Nama Sekolah</label><input type="text" id="adm-nama" class="inp"></div>
                            <div><label class="lbl">Running Text</label><input type="text" id="adm-running" class="inp"></div>
                            <div><label class="lbl">Link LMS / E-Learning</label><input type="text" id="adm-lms" class="inp" placeholder="https://..."></div>
                            <div><label class="lbl">Google Maps Embed URL</label><input type="text" id="adm-maps" class="inp"></div>
                            <div class="grid grid-cols-3 gap-4">
                                <div><label class="lbl">Facebook</label><input type="text" id="adm-fb" class="inp"></div>
                                <div><label class="lbl">Instagram</label><input type="text" id="adm-ig" class="inp"></div>
                                <div><label class="lbl">Youtube</label><input type="text" id="adm-yt" class="inp"></div>
                            </div>
                            <button class="btn-primary mt-4">Simpan Konfigurasi</button>
                        </form>
                    </div>

                    <!-- GURU -->
                    <div id="tab-guru" class="tab-content hidden">
                        <div class="flex justify-between mb-4">
                            <h4 class="font-bold">Data Guru</h4>
                            <button onclick="editItem('guru', null)" class="btn-sm-primary">+ Tambah Guru</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left border rounded">
                                <thead class="bg-slate-100"><tr><th class="p-2">Nama</th><th class="p-2">Jabatan</th><th class="p-2">Aksi</th></tr></thead>
                                <tbody id="adm-tbl-guru"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- SISWA -->
                    <div id="tab-siswa" class="tab-content hidden">
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-4 text-sm text-blue-700">
                            Data siswa dikelola per kelas. Edit jumlah Laki-laki (L) dan Perempuan (P) untuk setiap kelas.
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left border">
                                <thead class="bg-slate-100"><tr><th class="p-2">Kelas</th><th class="p-2">Laki-Laki</th><th class="p-2">Perempuan</th><th class="p-2">Aksi</th></tr></thead>
                                <tbody id="adm-tbl-siswa"></tbody>
                            </table>
                        </div>
                        <button onclick="addKelasRow()" class="mt-4 text-sm text-accent font-bold">+ Tambah Kelas</button>
                    </div>

                    <!-- MUTASI -->
                    <div id="tab-mutasi" class="tab-content hidden">
                        <h4 class="font-bold mb-4">Input Mutasi Siswa</h4>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm border text-center">
                                <thead class="bg-slate-100">
                                    <tr><th>Kelas</th><th>L Masuk</th><th>P Masuk</th><th>L Keluar</th><th>P Keluar</th><th>Aksi</th></tr>
                                </thead>
                                <tbody id="adm-tbl-mutasi"></tbody>
                            </table>
                        </div>
                         <button onclick="saveMutasi()" class="mt-4 btn-primary">Simpan Mutasi</button>
                    </div>

                    <!-- FASILITAS -->
                    <div id="tab-fasilitas" class="tab-content hidden">
                        <h4 class="font-bold mb-4">Kelola Fasilitas</h4>
                        <div id="adm-list-fasilitas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2"></div>
                        <button onclick="editItem('fasilitas',null)" class="btn-sm-primary mt-4">+ Fasilitas</button>
                    </div>

                    <!-- BERITA & GALERI PLACEHOLDERS -->
                    <div id="tab-berita" class="tab-content hidden"><h4 class="font-bold mb-4">Kelola Berita</h4><div id="adm-list-berita"></div><button onclick="editItem('berita',null)" class="btn-sm-primary mt-4">+ Berita Baru</button></div>
                    <div id="tab-galeri" class="tab-content hidden"><h4 class="font-bold mb-4">Kelola Galeri</h4><div id="adm-list-galeri" class="grid grid-cols-3 gap-2"></div><button onclick="editItem('galeri',null)" class="btn-sm-primary mt-4">+ Upload</button></div>

                </div>
            </div>
        </div>
    </div>

    <!-- SPMB MODAL -->
    <div id="modal-spmb" class="fixed inset-0 bg-black/80 hidden z-[85] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl relative">
            <button onclick="document.getElementById('modal-spmb').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold text-primary mb-1">Form PPDB Online</h3>
            <p class="text-sm text-slate-500 mb-4">Silakan isi data calon siswa baru</p>
            <form onsubmit="kirimSPMB(event)" class="space-y-3">
                <input type="text" name="nama" placeholder="Nama Lengkap Siswa" class="inp" required>
                <input type="text" name="nik" placeholder="NIK" class="inp" required>
                <input type="text" name="hp" placeholder="No HP Orang Tua (WA)" class="inp" required>
                <button type="submit" class="w-full btn-primary py-3">Kirim Pendaftaran</button>
            </form>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div id="modal-login" class="fixed inset-0 bg-black/80 hidden z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-sm w-full p-6 shadow-2xl relative">
            <button onclick="document.getElementById('modal-login').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold text-primary mb-1">Login Admin</h3>
            <form onsubmit="doLogin(event)" class="mt-4">
                <input type="text" name="user" placeholder="Username" class="inp mb-3" required>
                <input type="password" name="pass" placeholder="Password" class="inp mb-4" required>
                <button type="submit" class="w-full btn-primary py-3">Masuk</button>
            </form>
        </div>
    </div>

    <!-- DYNAMIC FORM MODAL -->
    <div id="modal-form" class="fixed inset-0 bg-black/60 hidden z-[90] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl relative">
            <h3 id="form-title" class="font-bold text-lg mb-4">Form Data</h3>
            <form id="dynamic-form" class="space-y-3"></form>
            <div class="flex justify-end gap-2 mt-4">
                <button onclick="document.getElementById('modal-form').classList.add('hidden')" class="px-4 py-2 text-sm text-slate-500 hover:bg-slate-100 rounded">Batal</button>
                <button onclick="submitDynamicForm()" class="px-4 py-2 text-sm bg-accent text-white rounded hover:bg-blue-600">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // --- STYLES HELPER ---
        const styles = document.createElement('style');
        styles.innerHTML = `
            .inp { width: 100%; padding: 0.75rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 0.875rem; transition: border 0.3s; }
            .inp:focus { outline: none; border-color: #2563eb; ring: 2px solid #bfdbfe; }
            .lbl { display: block; font-size: 0.75rem; font-weight: 700; color: #64748b; margin-bottom: 0.25rem; }
            .btn-primary { background-color: #0f172a; color: white; font-weight: 700; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background 0.3s; }
            .btn-primary:hover { background-color: #1e293b; }
            .btn-sm-primary { background-color: #2563eb; color: white; font-size: 0.75rem; padding: 0.25rem 0.75rem; border-radius: 0.25rem; }
            .filter-btn.active-filter { background-color: #2563eb; color: white; }
        `;
        document.head.appendChild(styles);

        // --- MAIN SCRIPT ---
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbx7X2qGgC1iT35yTz-yqD3Z123/exec'; // Placeholder
        let rawData = {};
        let isAdmin = localStorage.getItem('isAdmin') === 'true';

        // --- SAFETY LOADER REMOVER (Anti Stuck) ---
        setTimeout(() => {
            const loader = document.getElementById('loading');
            if(loader) {
                console.warn("Force removing loader...");
                loader.classList.add('opacity-0');
                setTimeout(() => loader.remove(), 500);
            }
        }, 3000); // 3 Detik Maksimal Loading

        window.addEventListener('load', async () => {
            if(isAdmin) document.body.classList.add('admin-mode');
            await loadData();
        });

        async function loadData() {
            try {
                // DATA YANG DIISI MANUAL DARI CSV ANDA
                const json = {
                    config: {
                        NamaSekolah: "SD Negeri 04 Taman",
                        RunningText: "Selamat Datang di Website Resmi SD Negeri 04 Taman",
                        LogoURL: "https://i.postimg.cc/CxkhTg41/Whats-App-Image-2025-03-06-at-09-04-17-removebg-preview.png",
                        BannerURL: "https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png",
                        SambutanKS: "Pendidikan adalah senjata paling ampuh untuk mengubah dunia. Mari bersinergi membangun karakter anak bangsa.",
                        Visi: "Terwujudnya Peserta Didik yang Bertaqwa, Cerdas, Unggul dalam prestasi dan Berdaya Guna.",
                        Misi: "1. Melaksanakan pembelajaran aktif, inovatif, kreatif, efektif dan menyenangkan.\n2. Mengembangkan bakat dan minat siswa.\n3. Menanamkan nilai-nilai karakter.",
                        Alamat: "Jalan Narasoma No.1, Taman, Kec.Taman, Kab. Pemalang, Jateng, 52361",
                        EmailSekolah: "sdn04taman@gmail.com",
                        GoogleMapsEmbed: "https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3960.9217349990363!2d109.4007788!3d-6.8999636!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6fdb7437a71bd5%3A0xbdf8c2aa130e3359!2sSDN%204%20Taman!5e0!3m2!1sid!2sid",
                        LMS_Link: "#",
                        Facebook: "#", Instagram: "#", Youtube: "#"
                    },
                    // Data Guru dari CSV
                    guru: [
                        ["1","kepalasekolah","12345@","Tentrem Lestari, S.Pd.","","Kepala Sekolah","lestari@sekolah.sch.id","https://i.postimg.cc/Vs2v3Dcg/1-TENTREM-LESTARI-S-Pd.png"],
                        ["2","gurukls1a","12345@","Ita Khusnul Hidayah, S.Pd.","","Guru kelas 1A","ita@sekolah.sch.id","https://i.postimg.cc/VNTPdZgx/4-ITA-KHUSNUL-HIDAYAH-S-Pd.jpg"],
                        ["3","gurukls1b","12345@","Indri Nurmala sari, S.Pd.","","Guru Kelas 1B","indri@sekolah.sch.id","https://i.postimg.cc/wTVKhjF2/11-INDRI-NURMALASARI-S-Pd.jpg"],
                        ["4","gurukls2a","12345@","Uci Apriliyani, S.Pd.","","Guru Kelas 2A","uci@sekolah.sch.id","https://i.postimg.cc/Y065Dr7r/7-UCI-APRILIYANI-S-Pd.jpg"],
                        ["5","gurukls2b","12345@","Dina Nur Afiyah, S.Pd.","","Guru Kelas 2B","Dina@sekolah.sch.id","https://i.postimg.cc/PxWLyDCL/Whats-App-Image.jpg"],
                        ["6","gurukls3a","12345@","Kharis Budi Santoso, S.Pd.","","Guru Kelas 3A","kharis@sekolah.sch.id","https://i.postimg.cc/FFqSMMtg/Gemini-Generated-Image-z2460z2460z2460z.png"],
                        ["7","gurukls3b","12345@","Yenining Tiyas, S.Pd.","","Guru Kelas 3B","Yeni@sekolah.sch.id","https://i.postimg.cc/sxs6XpFB/6-YENINING-TIYAS-S-Pd.jpg"],
                        ["8","gurukls4a","12345@","Nuryasih, S.Pd.","","Guru Kelas 4A","Asih@sekolah.sch.id","https://i.postimg.cc/q7N9VX0V/2-NURYASIH-S-Pd.png"],
                        ["9","gurukls4b","12345@","Bayu Prahastian, S.Pd.","199601212025211014","Guru Kelas 4B","bayu@sekolah.sch.id","https://i.postimg.cc/XYRgqwdv/12-BAYU-PRAHASTIAN-S-Pd.jpg"],
                        ["10","gurukls5a","12345@","Idhi Agung Mulyawan, S.Pd.","","Guru Kelas 5A","idhi@sekolah.sch.id","https://i.postimg.cc/zfHPPzSJ/5-IDHI-AGUNG-MULYAWAN-S-Pd.jpg"]
                    ],
                    // Data Siswa dari CSV
                    siswa: [ 
                        ["Kelas 1 A", 15, 13], ["Kelas 1 B", 15, 13],
                        ["Kelas 2 A", 19, 15], ["Kelas 2 B", 19, 15],
                        ["Kelas 3 A", 14, 12], ["Kelas 3 B", 14, 13],
                        ["Kelas 4 A", 17, 12], ["Kelas 4 B", 18, 11],
                        ["Kelas 5 A", 11, 13], ["Kelas 5 B", 13, 11],
                        ["Kelas 6 A", 17, 12], ["Kelas 6 B", 19, 12]
                    ],
                    // Data Mutasi dari CSV
                    mutasi: [ 
                        ["Kelas 1", 0, 0, 0, 0], ["Kelas 2", 1, 0, 0, 0],
                        ["Kelas 3", 0, 1, 0, 0], ["Kelas 4", 0, 0, 0, 1],
                        ["Kelas 5", 0, 0, 0, 0], ["Kelas 6", 0, 0, 0, 0]
                    ],
                    // Data Fasilitas dari CSV
                    fasilitas: [ 
                        ["Sapras", "8 Ruang Kelas", "Kondisi Baik", ""],
                        ["Sapras", "1 Perpustakaan", "Lengkap", ""],
                        ["Sapras", "1 Musolah", "Bersih", ""],
                        ["Ekstrakulikuler", "Pramuka", "Wajib Hari Sabtu", "https://via.placeholder.com/200?text=Pramuka"],
                        ["Ekstrakulikuler", "Rebana", "Seni Islami", "https://via.placeholder.com/200?text=Rebana"],
                        ["Ekstrakulikuler", "Karate", "Bela Diri", "https://via.placeholder.com/200?text=Karate"]
                    ],
                    // Berita dari CSV
                    berita: [
                        ["Website Resmi Diluncurkan", "06/02/2026", "Selamat datang di website resmi SD Negeri 04 Taman. Website ini digunakan sebagai media informasi dan komunikasi sekolah.", "https://via.placeholder.com/400"]
                    ],
                    // Downloads dari CSV
                    downloads: [
                        ["Jadwal Pelajaran Smt 2", "#", "Akademik"]
                    ],
                    galeri: [
                        ["Banner", "Slide 1", "https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png"],
                        ["Video", "Profil Sekolah", "#"]
                    ]
                };

                rawData = json;
                renderAll(json);
                
                // Remove Loading
                const loadEl = document.getElementById('loading');
                if(loadEl) {
                    loadEl.classList.add('opacity-0');
                    setTimeout(()=> loadEl.remove(), 500);
                }
            } catch(e) { 
                console.error("Error Rendering:", e);
                // Even on error, remove loading so user sees something
                document.getElementById('loading').remove();
            }
        }

        function renderAll(d) {
            if(!d || !d.config) return;

            const c = d.config;
            
            // 1. HEADER & CONFIG
            if(c.LogoURL) {
                const img = document.getElementById('nav-logo');
                img.src = c.LogoURL;
                document.getElementById('nav-logo').classList.remove('hidden');
            }
            document.getElementById('nav-nama-sekolah').innerText = c.NamaSekolah;
            document.getElementById('hero-title').innerText = c.NamaSekolah.toUpperCase();
            if(c.GoogleMapsEmbed) document.getElementById('maps-container').innerHTML = `<iframe src="${c.GoogleMapsEmbed}" width="100%" height="100%" style="border:0;" loading="lazy"></iframe>`;
            document.getElementById('footer-alamat').innerText = c.Alamat;
            document.getElementById('footer-email').innerText = c.EmailSekolah;
            
            // LMS Link
            if(c.LMS_Link && c.LMS_Link !== '#') {
                document.getElementById('btn-lms').href = c.LMS_Link;
                document.getElementById('footer-lms').href = c.LMS_Link;
                document.getElementById('lms-mobile-link').href = c.LMS_Link;
            }

            // 2. PROFIL
            // Mencari kepala sekolah (bisa case insensitive)
            const ks = d.guru.find(g => g[5] && g[5].toLowerCase().replace(/\s/g,'').includes('kepalasekolah')) || d.guru[0];
            
            if(ks) {
                document.getElementById('ks-nama').innerText = ks[3];
                document.getElementById('ks-nama-badge').innerText = ks[3];
                document.getElementById('ks-nip').innerText = ks[4] || '-';
                if(ks[7]) document.getElementById('ks-foto').src = ks[7];
            }
            document.getElementById('ks-sambutan').innerText = `"${c.SambutanKS}"`;
            document.getElementById('visi-text').innerText = `"${c.Visi}"`;
            
            // Split Misi
            if(c.Misi) {
                const misiArr = c.Misi.split('\n');
                document.getElementById('misi-list').innerHTML = misiArr.map(m => `<li><i class="fa-solid fa-check text-emerald-400 mr-2"></i>${m}</li>`).join('');
            }

            // 3. STATISTIK & DATA SISWA
            let totL = 0, totP = 0;
            const siswaBody = document.getElementById('siswa-tbody');
            if(d.siswa && d.siswa.length > 0) {
                siswaBody.innerHTML = '';
                d.siswa.forEach(k => {
                    const l = parseInt(k[1]) || 0;
                    const p = parseInt(k[2]) || 0;
                    totL += l; totP += p;
                    siswaBody.innerHTML += `
                        <tr class="hover:bg-slate-50 border-b border-slate-50 text-center">
                            <td class="p-3 text-left font-medium text-slate-700">${k[0]}</td>
                            <td class="p-3 text-slate-500">${l}</td>
                            <td class="p-3 text-slate-500">${p}</td>
                            <td class="p-3 font-bold text-primary bg-slate-50">${l+p}</td>
                        </tr>
                    `;
                });
            }

            document.getElementById('total-siswa').innerText = totL + totP;
            document.getElementById('total-lk').innerText = totL;
            document.getElementById('total-pr').innerText = totP;
            document.getElementById('total-rombel').innerText = d.siswa ? d.siswa.length : 0;

            // Chart
            const ctx = document.getElementById('genderChart');
            if(ctx) {
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Laki-Laki', 'Perempuan'],
                        datasets: [{
                            data: [totL, totP],
                            backgroundColor: ['#1e293b', '#ec4899'],
                            borderWidth: 0
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false,
                        cutout: '70%',
                        plugins: { legend: { display: false } } 
                    }
                });
            }

            // 4. MUTASI
            const mutasiBody = document.getElementById('mutasi-tbody');
            if(d.mutasi) {
                mutasiBody.innerHTML = d.mutasi.map(m => `
                    <tr class="border-b">
                        <td class="p-2 font-medium text-left pl-4">${m[0]}</td>
                        <td class="p-2 bg-emerald-50 text-emerald-700">${m[1]||0}</td>
                        <td class="p-2 bg-emerald-50 text-emerald-700">${m[2]||0}</td>
                        <td class="p-2 bg-rose-50 text-rose-700">${m[3]||0}</td>
                        <td class="p-2 bg-rose-50 text-rose-700">${m[4]||0}</td>
                    </tr>
                `).join('');
            }

            // 5. GURU
            if(d.guru) {
                document.getElementById('guru-grid').innerHTML = d.guru.map(g => `
                    <div class="bg-white rounded-xl p-4 text-center shadow-sm hover:shadow-md transition border border-slate-100 group">
                        <div class="w-24 h-24 mx-auto rounded-full overflow-hidden mb-3 border-2 border-slate-100 group-hover:border-accent transition relative">
                            <img src="${g[7]||'https://via.placeholder.com/150?text=Guru'}" class="w-full h-full object-cover">
                        </div>
                        <h5 class="font-bold text-sm text-primary line-clamp-1 group-hover:text-accent transition">${g[3]}</h5>
                        <p class="text-[10px] text-slate-500 uppercase tracking-wide mt-1 bg-slate-100 rounded py-0.5">${g[5]}</p>
                    </div>
                `).join('');
            }

            // 6. FASILITAS (Default All)
            renderFasilitas('all');

            // 7. BERITA & DOWNLOAD
            if(d.berita) {
                document.getElementById('berita-list').innerHTML = d.berita.map(b => `
                    <div class="flex gap-4 group cursor-pointer bg-white p-3 rounded-lg border border-transparent hover:border-slate-100 transition">
                        <div class="w-24 h-24 rounded-lg overflow-hidden shrink-0 bg-slate-200">
                            <img src="${b[3] || 'https://via.placeholder.com/400'}" class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
                        </div>
                        <div>
                            <span class="text-[10px] text-accent font-bold bg-blue-50 px-2 py-0.5 rounded">${b[1]}</span>
                            <h4 class="font-bold text-primary group-hover:text-accent transition leading-snug mb-1 mt-1">${b[0]}</h4>
                            <p class="text-sm text-slate-500 line-clamp-2">${b[2]}</p>
                        </div>
                    </div>
                `).join('');
            }

            const dlList = document.getElementById('download-list');
            if(d.downloads && d.downloads.length > 0) {
                dlList.innerHTML = d.downloads.map(x => `
                    <li class="flex items-center justify-between p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition border border-slate-100">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded bg-red-100 text-red-500 flex items-center justify-center"><i class="fa-solid fa-file-pdf"></i></div>
                            <div>
                                <p class="text-sm font-bold text-slate-700 line-clamp-1">${x[0]}</p>
                                <p class="text-[10px] text-slate-400 uppercase">${x[2]}</p>
                            </div>
                        </div>
                        <a href="${x[1]}" target="_blank" class="text-slate-400 hover:text-accent px-2"><i class="fa-solid fa-download"></i></a>
                    </li>
                `).join('');
            }
        }

        function filterFasilitas(cat) {
            // Update buttons active state
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('active-filter', 'bg-primary', 'text-white');
                b.classList.add('bg-slate-100', 'text-slate-600');
                
                if(b.innerText.toLowerCase().includes(cat === 'all' ? 'semua' : (cat==='Sapras'?'sarana':'ekstra'))) {
                    b.classList.remove('bg-slate-100', 'text-slate-600');
                    b.classList.add('active-filter', 'bg-primary', 'text-white');
                }
            });

            const all = rawData.fasilitas || [];
            const filtered = cat === 'all' ? all : all.filter(f => f[0] === cat);
            
            const grid = document.getElementById('fasilitas-grid');
            if(grid) {
                grid.innerHTML = filtered.map(f => `
                    <div class="bg-white rounded-xl overflow-hidden shadow-sm border border-slate-100 hover:shadow-md transition group h-full flex flex-col">
                        ${f[3] ? `<div class="h-40 overflow-hidden bg-slate-200"><img src="${f[3]}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500"></div>` : ''}
                        <div class="p-4 flex-1">
                            <span class="text-[10px] font-bold bg-slate-100 px-2 py-1 rounded text-slate-500 uppercase tracking-wide">${f[0]}</span>
                            <h4 class="font-bold text-primary mt-2 text-lg">${f[1]}</h4>
                            ${f[2] ? `<p class="text-sm text-slate-500 mt-2 line-clamp-3">${f[2]}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // --- ADMIN LOGIC ---
        function openLogin() {
            if(isAdmin) { document.getElementById('modal-admin').classList.remove('hidden'); return; }
            document.getElementById('modal-login').classList.remove('hidden');
        }

        async function doLogin(e) {
            e.preventDefault();
            const u = e.target.user.value;
            const p = e.target.pass.value;
            if(u === 'admin' && p === 'admin123') { 
                localStorage.setItem('isAdmin', 'true');
                location.reload();
            } else alert('Password salah (Coba: admin / admin123)');
        }
        function doLogout() { localStorage.removeItem('isAdmin'); location.reload(); }
        function closeModal() { document.getElementById('modal-admin').classList.add('hidden'); }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.add('hidden'));
            document.getElementById(`tab-${t}`).classList.remove('hidden');
            
            // Populate Specific Admin Data
            if(t==='config') {
                const c = rawData.config;
                document.getElementById('adm-nama').value = c.NamaSekolah;
                document.getElementById('adm-running').value = c.RunningText;
                document.getElementById('adm-lms').value = c.LMS_Link;
                document.getElementById('adm-maps').value = c.GoogleMapsEmbed;
                document.getElementById('adm-fb').value = c.Facebook;
                // dll...
            }
            if(t==='guru') {
                document.getElementById('adm-tbl-guru').innerHTML = rawData.guru.map((g,i) => `
                    <tr class="border-b">
                        <td class="p-2">${g[3]}</td>
                        <td class="p-2 text-xs text-slate-500">${g[5]}</td>
                        <td class="p-2">
                             <button class="text-blue-500 hover:underline text-xs mr-2">Edit</button>
                             <button class="text-red-500 hover:underline text-xs">Hapus</button>
                        </td>
                    </tr>
                `).join('');
            }
            if(t==='siswa') {
                document.getElementById('adm-tbl-siswa').innerHTML = rawData.siswa.map((s,i) => `
                    <tr>
                        <td class="p-2"><input value="${s[0]}" class="border p-1 rounded w-full text-xs"></td>
                        <td class="p-2"><input type="number" value="${s[1]}" class="border p-1 rounded w-16 text-center text-xs"></td>
                        <td class="p-2"><input type="number" value="${s[2]}" class="border p-1 rounded w-16 text-center text-xs"></td>
                        <td class="p-2"><button onclick="deleteSiswaRow(${i})" class="text-red-500 hover:text-red-700 text-xs"><i class="fa-solid fa-trash"></i></button></td>
                    </tr>
                `).join('');
            }
            if(t==='mutasi') {
                document.getElementById('adm-tbl-mutasi').innerHTML = rawData.mutasi.map((m,i) => `
                    <tr>
                        <td class="p-2 font-bold text-xs">${m[0]}</td>
                        <td class="p-2"><input type="number" value="${m[1]}" class="mut-lm w-12 border p-1 rounded text-center text-xs"></td>
                        <td class="p-2"><input type="number" value="${m[2]}" class="mut-pm w-12 border p-1 rounded text-center text-xs"></td>
                        <td class="p-2"><input type="number" value="${m[3]}" class="mut-lk w-12 border p-1 rounded text-center text-xs"></td>
                        <td class="p-2"><input type="number" value="${m[4]}" class="mut-pk w-12 border p-1 rounded text-center text-xs"></td>
                        <td><button class="text-red-500 text-xs">x</button></td>
                    </tr>
                `).join('');
            }
            if(t==='fasilitas') {
                document.getElementById('adm-list-fasilitas').innerHTML = rawData.fasilitas.map(f => `
                    <div class="border p-2 rounded flex gap-2 items-center">
                        <div class="w-10 h-10 bg-slate-200 rounded shrink-0 overflow-hidden"><img src="${f[3]||'https://via.placeholder.com/50'}" class="w-full h-full object-cover"></div>
                        <div class="overflow-hidden">
                            <h5 class="font-bold text-xs truncate">${f[1]}</h5>
                            <p class="text-[10px] text-slate-500 truncate">${f[0]}</p>
                        </div>
                        <button class="ml-auto text-red-500 text-xs"><i class="fa-solid fa-trash"></i></button>
                    </div>
                `).join('');
            }
        }

        function addKelasRow() {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td class="p-2"><input placeholder="Kelas..." class="border p-1 rounded w-full text-xs"></td><td class="p-2"><input type="number" value="0" class="border p-1 rounded w-16 text-center text-xs"></td><td class="p-2"><input type="number" value="0" class="border p-1 rounded w-16 text-center text-xs"></td><td><button class="text-red-500 text-xs">x</button></td>`;
            document.getElementById('adm-tbl-siswa').appendChild(tr);
        }

        async function saveWebConfig(e) {
            e.preventDefault();
            // Simulasi Simpan
            alert("Konfigurasi tersimpan (Mode Simulasi)");
            location.reload();
        }

        async function kirimSPMB(e) {
            e.preventDefault();
            alert('Pendaftaran berhasil! Data akan masuk ke Google Sheet.');
            document.getElementById('modal-spmb').classList.add('hidden');
        }
        
        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        // Form Handler Dynamic
        function editItem(type, id) {
            const m = document.getElementById('modal-form');
            const f = document.getElementById('dynamic-form');
            m.classList.remove('hidden');
            f.innerHTML = '';
            
            if(type === 'guru') {
                 f.innerHTML = `<input placeholder="Nama Lengkap" class="inp"><input placeholder="Jabatan/Mapel" class="inp"><input placeholder="URL Foto" class="inp">`;
            }
            // Add other types logic...
        }
        function submitDynamicForm() {
            alert('Data disimpan (Simulasi)');
            location.reload();
        }

    </script>
</body>
</html>