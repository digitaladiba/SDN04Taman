<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Informasi Digital SDN 4 Taman</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { 
                        primary: '#0f172a', 
                        accent: '#2563eb', 
                        gold: '#fbbf24', 
                        emerald: '#10b981', 
                        rose: '#f43f5e'
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .slide-item { position: absolute; inset: 0; transition: opacity 1.5s ease-in-out; opacity: 0; z-index: 0; }
        .slide-item.active { opacity: 1; z-index: 10; }
        html { scroll-behavior: smooth; }
        
        /* Admin Controls */
        .admin-only { display: none !important; }
        body.admin-mode .admin-only { display: inline-flex !important; }
        body.admin-mode .admin-block { display: block !important; }
        
        /* Edit Overlay */
        .editable { position: relative; }
        .editable:hover::after {
            content: '‚úèÔ∏è Edit';
            position: absolute; inset: 0; background: rgba(0,0,0,0.6);
            display: none; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 1.2rem; cursor: pointer; z-index: 20; border-radius: inherit;
        }
        body.admin-mode .editable:hover::after { display: flex; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-accent selection:text-white">

    <!-- NAVBAR -->
    <nav class="fixed w-full z-50 glass-nav border-b border-slate-200 transition-all duration-300 shadow-sm" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-3">
                    <img id="nav-logo" src="" alt="Logo" class="h-12 w-auto object-contain hidden">
                    <div class="leading-tight">
                        <h1 id="nav-nama-sekolah" class="text-xl font-bold text-primary">SDN 4 Taman</h1>
                        <p class="text-[10px] md:text-xs text-slate-500 font-bold tracking-widest uppercase">Berkarakter & Berprestasi</p>
                    </div>
                </div>
                
                <div class="hidden lg:flex space-x-6 items-center">
                    <a href="#beranda" class="nav-item text-sm font-semibold text-slate-600 hover:text-accent transition">Beranda</a>
                    <div class="relative group">
                        <button class="nav-item text-sm font-semibold text-slate-600 hover:text-accent flex items-center gap-1 py-4">Profil <i class="fa-solid fa-chevron-down text-xs"></i></button>
                        <div class="absolute top-full left-0 w-56 bg-white border border-slate-100 shadow-xl rounded-xl p-2 hidden group-hover:block animate-fade-in z-50">
                            <a href="#sambutan" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Sambutan KS</a>
                            <a href="#visi-misi" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Visi & Misi</a>
                            <a href="#guru" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Guru & Staff</a>
                            <a href="#sotk" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Struktur Organisasi</a>
                        </div>
                    </div>
                    <div class="relative group">
                        <button class="nav-item text-sm font-semibold text-slate-600 hover:text-accent flex items-center gap-1 py-4">Data <i class="fa-solid fa-chevron-down text-xs"></i></button>
                        <div class="absolute top-full left-0 w-56 bg-white border border-slate-100 shadow-xl rounded-xl p-2 hidden group-hover:block animate-fade-in z-50">
                            <a href="#data-siswa" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Data Siswa</a>
                            <a href="#mutasi" class="block px-4 py-2 text-sm hover:bg-slate-50 rounded font-medium text-slate-600">Mutasi Siswa</a>
                        </div>
                    </div>
                    <a href="#fasilitas" class="nav-item text-sm font-semibold text-slate-600 hover:text-accent transition">Fasilitas</a>
                    
                    <a href="#" id="btn-lms" target="_blank" class="px-4 py-2 bg-orange-500 text-white text-sm font-bold rounded-lg hover:bg-orange-600 transition shadow-lg shadow-orange-500/20 flex items-center gap-2">
                        <i class="fa-solid fa-laptop-code"></i> LMS
                    </a>

                    <button onclick="handleLoginButton()" id="btn-login" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-accent hover:text-white flex items-center justify-center transition shadow-sm border border-slate-200" title="Login Admin">
                        <i class="fa-solid fa-lock text-xs"></i>
                    </button>
                </div>

                <button onclick="toggleMobileMenu()" class="lg:hidden text-slate-600 text-2xl"><i class="fa-solid fa-bars"></i></button>
            </div>
        </div>
        
        <!-- MOBILE MENU -->
        <div id="mobile-menu" class="hidden lg:hidden bg-white border-t p-4 space-y-3 shadow-xl max-h-[80vh] overflow-y-auto">
            <a href="#beranda" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Beranda</a>
            <a href="#guru" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Data Guru</a>
            <a href="#data-siswa" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">Data Siswa</a>
            <a href="#sotk" class="block font-medium text-slate-600 p-2 hover:bg-slate-50 rounded">SOTK</a>
            <a href="#" id="lms-mobile-link" target="_blank" class="block font-bold text-orange-500 p-2 bg-orange-50 rounded text-center mt-4 border border-orange-200">Akses LMS</a>
            <button onclick="handleLoginButton()" id="btn-login-mobile" class="w-full text-center font-bold text-slate-500 p-2 border border-slate-200 rounded mt-2">Login Admin</button>
        </div>
    </nav>

    <!-- LOADING SCREEN -->
    <div id="loading" class="fixed inset-0 bg-white z-[100] flex flex-col items-center justify-center transition-opacity duration-500">
        <div class="w-16 h-16 border-4 border-slate-200 border-t-accent rounded-full animate-spin mb-4"></div>
        <p class="text-slate-500 font-medium animate-pulse">Menyiapkan Data Sekolah...</p>
    </div>
    
    <script>setTimeout(()=>{const l=document.getElementById('loading');if(l)l.remove()},3000);</script>

    <main class="pt-20">
        
        <!-- HERO & BANNER SLIDER -->
        <section id="beranda" class="relative w-full h-[500px] md:h-[650px] overflow-hidden bg-slate-900 group editable" onclick="if(isAdmin) openAdminModal('galeri')">
            <!-- Slider Container -->
            <div id="banner-slider" class="relative w-full h-full">
                <!-- Slides injected by JS -->
            </div>

            <!-- Overlay Content -->
            <div class="absolute inset-0 flex items-center justify-center z-20 text-center px-4">
                <div class="max-w-4xl animate-fade-in-up">
                    <span class="inline-block py-1 px-4 rounded-full bg-white/20 text-white backdrop-blur-md border border-white/30 text-xs font-bold mb-6">OFFICIAL WEBSITE</span>
                    <h2 class="text-4xl md:text-6xl font-extrabold text-white mb-6 leading-tight drop-shadow-lg" id="hero-title">SDN 4 TAMAN</h2>
                    <div class="bg-black/30 backdrop-blur-sm rounded-lg p-3 mb-8 max-w-2xl mx-auto border border-white/10 editable" onclick="event.stopPropagation(); if(isAdmin) openAdminModal('config')">
                         <p id="running-text-display" class="text-slate-200 text-lg">Selamat Datang...</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <a href="#spmb-section" id="btn-hero-spmb" class="px-8 py-3 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 transition shadow-lg shadow-green-500/30 flex items-center justify-center">
                            <i class="fa-solid fa-user-plus mr-2"></i> Info SPMB
                        </a>
                        <a href="#profil" class="px-8 py-3 bg-white text-slate-900 font-bold rounded-full hover:bg-slate-100 transition shadow-lg">
                            Profil Sekolah
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- SAMBUTAN KEPALA SEKOLAH -->
        <section id="sambutan" class="py-20 bg-white relative overflow-hidden">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row items-center gap-12">
                    <div class="md:w-1/3 relative text-center md:text-left group editable" onclick="if(isAdmin) openAdminModal('guru')">
                        <div class="absolute inset-0 bg-accent/10 rounded-3xl rotate-6 transform hidden md:block"></div>
                        <img id="ks-foto" src="" class="relative rounded-3xl shadow-2xl w-full max-w-xs mx-auto md:max-w-full object-cover h-[450px] border-4 border-white bg-slate-200">
                        <div class="edit-overlay rounded-3xl"><i class="fa-solid fa-pen mr-2"></i> Ganti Foto KS</div>
                    </div>
                    <div class="md:w-2/3 editable" onclick="if(isAdmin) openAdminModal('config')">
                        <span class="text-accent font-bold tracking-wider uppercase text-sm mb-2 block">Sambutan Kepala Sekolah</span>
                        <h2 class="text-3xl md:text-4xl font-bold text-primary mb-6">Assalamu'alaikum Warahmatullahi Wabarakatuh</h2>
                        <div class="prose prose-lg text-slate-600 mb-6 italic border-l-4 border-accent pl-6 py-2 bg-slate-50 rounded-r-lg">
                            <p id="ks-sambutan">"..."</p>
                        </div>
                        <h4 id="ks-nama" class="font-bold text-lg text-primary">-</h4>
                        <p class="text-slate-500">NIP. <span id="ks-nip">-</span></p>
                        <div class="edit-overlay"><i class="fa-solid fa-pen mr-2"></i> Edit Sambutan</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- VISI MISI -->
        <section id="visi-misi" class="py-16 bg-slate-900 text-white relative editable" onclick="if(isAdmin) openAdminModal('config')">
            <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-12 relative z-10">
                <div>
                    <h3 class="text-2xl font-bold text-white mb-6 border-b border-slate-700 pb-4"><i class="fa-solid fa-star text-yellow-400 mr-2"></i> Visi Sekolah</h3>
                    <p id="visi-text" class="text-lg leading-relaxed text-slate-300 font-light">Loading...</p>
                </div>
                <div>
                    <h3 class="text-2xl font-bold text-white mb-6 border-b border-slate-700 pb-4"><i class="fa-solid fa-list-check text-emerald-400 mr-2"></i> Misi Sekolah</h3>
                    <ul id="misi-list" class="space-y-3 text-slate-300"></ul>
                </div>
            </div>
        </section>

        <!-- DATA SISWA -->
        <section id="data-siswa" class="py-20 bg-slate-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-primary">Data Statistik Siswa</h2>
                    <p class="text-slate-500 mt-2">Kondisi Siswa Saat Ini</p>
                </div>

                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center border border-slate-200">
                        <h3 id="total-siswa" class="text-3xl font-bold text-slate-800">0</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 mt-1">Total Siswa</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center border border-slate-200">
                        <h3 id="total-lk" class="text-3xl font-bold text-blue-600">0</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 mt-1">Laki-Laki</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center border border-slate-200">
                        <h3 id="total-pr" class="text-3xl font-bold text-pink-500">0</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 mt-1">Perempuan</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center border border-slate-200">
                        <h3 id="total-rombel" class="text-3xl font-bold text-emerald-500">0</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 mt-1">Rombel</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-3 gap-8">
                    <div class="md:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden relative editable" onclick="if(isAdmin) openAdminModal('siswa')">
                        <div class="p-4 bg-slate-50 font-bold text-primary border-b">Rincian Per Kelas</div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-center">
                                <thead class="bg-slate-100 text-xs uppercase font-bold text-slate-600">
                                    <tr><th class="p-3 text-left">Kelas</th><th>L</th><th>P</th><th>JML</th></tr>
                                </thead>
                                <tbody id="siswa-tbody" class="divide-y divide-slate-100"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 flex flex-col items-center justify-center">
                        <h4 class="font-bold text-sm mb-6 text-slate-500 uppercase">Perbandingan Gender</h4>
                        <div class="w-40 h-40 relative"><canvas id="genderChart"></canvas></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- MUTASI -->
        <section id="mutasi" class="py-16 bg-white border-y border-slate-100 relative editable" onclick="if(isAdmin) openAdminModal('mutasi')">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold text-primary">Data Mutasi Siswa</h2>
                </div>
                <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-center">
                            <thead class="bg-primary text-white">
                                <tr>
                                    <th rowspan="2" class="p-3 border-r border-slate-600">Kelas</th>
                                    <th colspan="2" class="bg-emerald-600 border-b border-emerald-700">Masuk</th>
                                    <th colspan="2" class="bg-rose-600 border-b border-rose-700">Keluar</th>
                                </tr>
                                <tr>
                                    <th class="p-2 bg-emerald-700">L</th><th class="p-2 bg-emerald-700">P</th>
                                    <th class="p-2 bg-rose-700">L</th><th class="p-2 bg-rose-700">P</th>
                                </tr>
                            </thead>
                            <tbody id="mutasi-tbody" class="divide-y"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- GURU -->
        <section id="guru" class="py-20 bg-slate-50 relative">
            <button onclick="openAdminModal('guru')" class="admin-only absolute top-8 right-8 bg-accent text-white px-4 py-2 rounded shadow"><i class="fa-solid fa-plus mr-2"></i> Kelola Guru</button>
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-primary">Dewan Guru</h2>
                    <p class="text-slate-500">Pendidik Profesional SDN 4 Taman</p>
                </div>
                <div id="guru-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
                
                <!-- SOTK SECTION -->
                <div id="sotk" class="mt-16 bg-white p-8 rounded-2xl shadow-sm border border-slate-200 text-center relative editable" onclick="if(isAdmin) openAdminModal('galeri')">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold mx-auto">Struktur Organisasi (SOTK)</h3>
                    </div>
                    <div id="sotk-container" class="bg-slate-50 rounded-xl border border-slate-200 overflow-hidden min-h-[300px] flex items-center justify-center">
                        <p class="text-slate-400 italic">Memuat gambar SOTK dari Galeri...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- FASILITAS -->
        <section id="fasilitas" class="py-20 bg-white relative editable" onclick="if(isAdmin) openAdminModal('fasilitas')">
            <div class="max-w-7xl mx-auto px-4 text-center">
                 <h2 class="text-3xl font-bold text-primary mb-8">Fasilitas & Ekstrakurikuler</h2>
                 <div id="fasilitas-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </div>
        </section>

        <!-- BERITA -->
        <section id="berita" class="py-20 bg-slate-50 border-t relative">
            <button onclick="openAdminModal('berita')" class="admin-only absolute top-8 right-8 bg-emerald-500 text-white px-4 py-2 rounded shadow"><i class="fa-solid fa-plus mr-2"></i> Tambah Berita</button>
            <div class="max-w-7xl mx-auto px-4">
                <h2 class="text-3xl font-bold text-primary mb-8">Berita Terkini</h2>
                <div id="berita-list" class="grid md:grid-cols-2 gap-6"></div>
            </div>
        </section>

        <!-- SPMB & DOWNLOAD WIDGET -->
        <section id="spmb-section" class="py-20 bg-gradient-to-br from-blue-50 to-white border-t border-slate-200">
            <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-3 gap-12">
                <!-- Downloads -->
                <div class="md:col-span-1 bg-white p-6 rounded-2xl shadow-sm border border-slate-200 h-fit">
                    <h3 class="font-bold text-primary mb-4 flex items-center border-b pb-2"><i class="fa-solid fa-download mr-2 text-emerald-500"></i> Download Area</h3>
                    <ul id="download-list" class="space-y-3">
                        <li class="text-slate-400 text-sm italic">Memuat file...</li>
                    </ul>
                </div>

                <!-- SPMB Widget -->
                <div class="md:col-span-2">
                    <div id="spmb-widget" class="bg-gradient-to-br from-accent to-blue-600 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden group">
                        <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-16 -mt-16 blur-2xl"></div>
                        <div class="relative z-10">
                            <h3 class="font-bold text-3xl mb-2">SPMB Online</h3>
                            <p class="text-blue-100 mb-6">Sistem Penerimaan Murid Baru Tahun Ajaran 2026/2027</p>
                            
                            <!-- Status Indicator -->
                            <div class="flex items-center gap-4 mb-6">
                                <span id="spmb-status-badge" class="px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-slate-500 text-white shadow-sm">
                                    Memuat Status...
                                </span>
                            </div>

                            <div class="flex gap-4 flex-wrap">
                                <button id="btn-spmb-register" onclick="document.getElementById('modal-spmb').classList.remove('hidden')" class="px-6 py-3 bg-white text-accent font-bold rounded-lg hover:bg-blue-50 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
                                    Isi Formulir Pendaftaran
                                </button>
                                <a href="#" id="btn-spmb-wa" target="_blank" class="px-6 py-3 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition shadow-lg flex items-center">
                                    <i class="fa-brands fa-whatsapp mr-2"></i> Chat Panitia
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="bg-primary text-white pt-16 pb-8 border-t-4 border-accent relative editable" onclick="if(isAdmin) openAdminModal('config')">
            <div class="edit-overlay"><i class="fa-solid fa-pen mr-2"></i> Edit Kontak & Sosmed</div>
            <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-12 mb-12">
                <div>
                    <h3 class="font-bold text-xl mb-4" id="footer-nama">SDN 4 Taman</h3>
                    <p class="text-sm text-slate-400 mb-4" id="footer-alamat">Alamat...</p>
                    <div class="flex gap-4">
                        <a href="#" id="link-fb" target="_blank" class="text-white hover:text-accent transition"><i class="fa-brands fa-facebook fa-lg"></i></a>
                        <a href="#" id="link-ig" target="_blank" class="text-white hover:text-accent transition"><i class="fa-brands fa-instagram fa-lg"></i></a>
                        <a href="#" id="link-yt" target="_blank" class="text-white hover:text-accent transition"><i class="fa-brands fa-youtube fa-lg"></i></a>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Link Pintas</h3>
                    <ul class="text-sm space-y-2 text-slate-400">
                        <li><a href="#guru" class="hover:text-white">Data Guru</a></li>
                        <li><a href="#data-siswa" class="hover:text-white">Data Siswa</a></li>
                        <li><a href="#" id="footer-lms" target="_blank" class="hover:text-white text-orange-400 font-bold hidden">Akses LMS (E-Learning)</a></li>
                        <li><a href="#" id="footer-ppdb" target="_blank" class="hover:text-white text-green-400 font-bold hidden">Kontak SPMB (WA)</a></li>
                    </ul>
                </div>
                <div class="h-48 bg-slate-800 rounded-lg overflow-hidden" id="maps-container"></div>
            </div>
            <div class="text-center text-xs text-slate-500 pt-8 border-t border-slate-800">&copy; 2026 SDN 4 Taman. All Rights Reserved.</div>
        </footer>
    </main>

    <!-- ADMIN MODAL -->
    <div id="modal-admin" class="fixed inset-0 bg-black/50 hidden z-[70] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl w-full max-w-5xl h-[90vh] flex flex-col shadow-2xl">
            <div class="p-4 border-b flex justify-between items-center bg-slate-50">
                <h3 class="font-bold text-lg text-primary"><i class="fa-solid fa-user-gear text-accent mr-2"></i>Admin Dashboard</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-slate-200 hover:text-red-600 flex items-center justify-center"><i class="fa-solid fa-times"></i></button>
            </div>
            <div class="flex flex-1 overflow-hidden">
                <div class="w-64 bg-slate-50 border-r p-4 space-y-1 overflow-y-auto hidden md:block">
                    <button onclick="switchTab('config')" class="w-full text-left px-4 py-2 rounded text-sm hover:bg-white transition">‚öôÔ∏è Konfigurasi & SPMB</button>
                    <button onclick="switchTab('guru')" class="w-full text-left px-4 py-2 rounded text-sm hover:bg-white transition">üë®‚Äçüè´ Data Guru</button>
                    <button onclick="switchTab('siswa')" class="w-full text-left px-4 py-2 rounded text-sm hover:bg-white transition">üéì Data Siswa</button>
                    <button onclick="switchTab('mutasi')" class="w-full text-left px-4 py-2 rounded text-sm hover:bg-white transition">üìä Mutasi</button>
                    <button onclick="switchTab('galeri')" class="w-full text-left px-4 py-2 rounded text-sm hover:bg-white transition">üì∑ Galeri & SOTK</button>
                    <button onclick="switchTab('berita')" class="w-full text-left px-4 py-2 rounded text-sm hover:bg-white transition">üì∞ Berita</button>
                    <button onclick="switchTab('fasilitas')" class="w-full text-left px-4 py-2 rounded text-sm hover:bg-white transition">üè´ Fasilitas</button>
                    <button onclick="doLogout()" class="w-full text-left px-4 py-2 rounded text-sm text-red-600 hover:bg-red-50 mt-8">üö™ Logout</button>
                </div>
                <div class="flex-1 p-6 overflow-y-auto" id="modal-content">
                    
                    <!-- Config Tab -->
                    <div id="tab-config" class="tab-content">
                        <h4 class="font-bold mb-4 border-b pb-2">Pengaturan Umum & SPMB</h4>
                        <form onsubmit="saveData(event, 'config')" class="space-y-4 max-w-xl">
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-6">
                                <h5 class="font-bold text-accent mb-2">Kontrol Pendaftaran (SPMB)</h5>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="text-xs font-bold text-slate-500">Status Pendaftaran</label>
                                        <select id="adm-spmb-status" class="w-full border p-2 rounded bg-white">
                                            <option value="Tutup">‚õî Ditutup</option>
                                            <option value="Buka">‚úÖ Dibuka</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-slate-500">No WA Panitia (Format 62..)</label>
                                        <input id="adm-wa" class="w-full border p-2 rounded" type="number">
                                    </div>
                                </div>
                            </div>

                            <div><label class="text-xs font-bold text-slate-500">Nama Sekolah</label><input id="adm-nama" class="w-full border p-2 rounded"></div>
                            <div><label class="text-xs font-bold text-slate-500">Running Text</label><input id="adm-running" class="w-full border p-2 rounded"></div>
                            <div><label class="text-xs font-bold text-slate-500">Link LMS (E-Learning)</label><input id="adm-lms" class="w-full border p-2 rounded"></div>
                            
                            <div class="grid grid-cols-3 gap-2">
                                <div><label class="text-xs font-bold text-slate-500">Facebook</label><input id="adm-fb" class="w-full border p-2 rounded"></div>
                                <div><label class="text-xs font-bold text-slate-500">Instagram</label><input id="adm-ig" class="w-full border p-2 rounded"></div>
                                <div><label class="text-xs font-bold text-slate-500">Youtube</label><input id="adm-yt" class="w-full border p-2 rounded"></div>
                            </div>
                            <button class="bg-primary text-white px-4 py-2 rounded text-sm font-bold w-full">Simpan Perubahan</button>
                        </form>
                    </div>

                    <!-- Guru Tab -->
                    <div id="tab-guru" class="tab-content hidden">
                         <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold">Data Guru</h4>
                            <button onclick="addItem('guru')" class="bg-accent text-white px-3 py-1 rounded text-xs">+ Tambah</button>
                        </div>
                        <div id="adm-list-guru" class="space-y-2"></div>
                    </div>

                    <!-- Siswa Tab -->
                    <div id="tab-siswa" class="tab-content hidden">
                        <h4 class="font-bold mb-4">Data Siswa Per Kelas</h4>
                        <table class="w-full text-sm text-left border rounded">
                            <thead class="bg-slate-100"><tr><th class="p-2">Kelas</th><th>L</th><th>P</th><th>Aksi</th></tr></thead>
                            <tbody id="adm-list-siswa"></tbody>
                        </table>
                    </div>

                     <!-- Mutasi Tab (Fixed: Inputable) -->
                    <div id="tab-mutasi" class="tab-content hidden">
                        <h4 class="font-bold mb-4">Data Mutasi (Edit Langsung)</h4>
                        <table class="w-full text-sm text-center border rounded">
                            <thead class="bg-slate-100"><tr><th class="p-2">Kelas</th><th>L Masuk</th><th>P Masuk</th><th>L Keluar</th><th>P Keluar</th></tr></thead>
                            <tbody id="adm-list-mutasi"></tbody>
                        </table>
                        <div class="mt-4 p-2 bg-yellow-50 text-xs text-yellow-800 rounded border border-yellow-200">
                            Info: Ketik angka langsung di kolom, data otomatis tersimpan di memori sementara.
                        </div>
                    </div>

                    <!-- Galeri Tab -->
                    <div id="tab-galeri" class="tab-content hidden">
                        <h4 class="font-bold mb-4">Galeri & Banner</h4>
                        <div class="bg-blue-50 p-2 rounded text-xs mb-4">
                            Tips: Upload dengan Tipe <b>Banner</b> untuk slider, atau judul <b>SOTK</b> untuk struktur organisasi.
                        </div>
                        <button onclick="addItem('galeri')" class="bg-accent text-white px-3 py-1 rounded text-xs mb-4">+ Upload</button>
                        <div id="adm-list-galeri" class="grid grid-cols-3 gap-4"></div>
                    </div>

                    <!-- Berita Tab -->
                    <div id="tab-berita" class="tab-content hidden">
                         <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold">Berita</h4>
                            <button onclick="addItem('berita')" class="bg-accent text-white px-3 py-1 rounded text-xs">+ Tambah</button>
                        </div>
                        <div id="adm-list-berita" class="space-y-2"></div>
                    </div>

                     <!-- Fasilitas Tab -->
                    <div id="tab-fasilitas" class="tab-content hidden">
                        <h4 class="font-bold mb-4">Fasilitas</h4>
                        <button onclick="addItem('fasilitas')" class="bg-accent text-white px-3 py-1 rounded text-xs mb-4">+ Tambah</button>
                        <div id="adm-list-fasilitas" class="space-y-2"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div id="modal-login" class="fixed inset-0 bg-black/80 hidden z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-sm w-full p-6 shadow-2xl relative">
            <button onclick="document.getElementById('modal-login').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold text-primary mb-4">Login Admin</h3>
            <form onsubmit="doLogin(event)">
                <input type="text" name="user" placeholder="Username" class="w-full border p-3 rounded mb-3" required>
                <input type="password" name="pass" placeholder="Password" class="w-full border p-3 rounded mb-4" required>
                <button type="submit" class="w-full bg-primary text-white font-bold py-3 rounded">Masuk</button>
            </form>
        </div>
    </div>

    <!-- SPMB FORM MODAL -->
    <div id="modal-spmb" class="fixed inset-0 bg-black/80 hidden z-[90] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6 shadow-2xl relative">
            <button onclick="document.getElementById('modal-spmb').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold text-primary mb-1">Formulir SPMB</h3>
            <p class="text-sm text-slate-500 mb-4">Data Calon Murid Baru</p>
            <form onsubmit="kirimSPMB(event)" class="space-y-3">
                <input type="text" name="nama" placeholder="Nama Lengkap Siswa" class="w-full border p-2 rounded" required>
                <input type="text" name="nik" placeholder="NIK" class="w-full border p-2 rounded" required>
                <input type="text" name="hp" placeholder="No HP Orang Tua (WA)" class="w-full border p-2 rounded" required>
                <button type="submit" class="w-full bg-accent text-white font-bold py-3 rounded hover:bg-blue-600">Kirim Pendaftaran</button>
            </form>
        </div>
    </div>

    <script>
        // --- 1. DATA DATABASE ASLI (PARSED FROM YOUR CSV) ---
        // Note: Saya menggunakan fungsi parseCSV sederhana untuk menangani koma dalam tanda kutip.
        
        const CSV_CONFIG = `Key,Value
NamaSekolah,SD Negeri 04 Taman
LogoURL,https://i.postimg.cc/CxkhTg41/Whats-App-Image-2025-03-06-at-09-04-17-removebg-preview.png
BannerURL,https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png
RunningText,Selamat Datang di Website Resmi SD Negeri 04 Taman
Admin,admin123
Alamat,"Jalan Narasoma No.1, Taman, Kec.Taman, Kab. Pemalang, Jateng, 52361"
EmailSekolah,sdn04taman@gmail.com
GoogleMapsEmbed,https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3960.9217349990363!2d109.4007788!3d-6.8999636!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e6fdb7437a71bd5%3A0xbdf8c2aa130e3359!2sSDN%204%20Taman!5e0!3m2!1sid!2sid!4v1770707408965!5m2!1sid!2sid
NoWaPPDB,62895357305031
SPMB_Status,Buka
SPMB_Info,Pendaftaran dibuka
LMS_Link,https://e-learning-sd.vercel.app/
Facebook,https://www.facebook.com/share/17rZf7Yykn/
Instagram,https://instagram.com
Youtube,https://youtube.com
Visi,"Terwujudnya Peserta Didik yang Bertaqwa, Cerdas, Unggul dalam presasi dan Berdaya Guna serta berwawasan Lingkungan."
Misi,"1. Melaksanakan pembelajaran aktif, inovatif, kreatif, efektif dan menyenangkan.
2. Mengembangkan bakat dan minat siswa.
3. Menanamkan nilai-nilai karakter."
SambutanKS,"Pendidikan adalah senjata paling ampuh untuk mengubah dunia. Mari bersinergi membangun karakter anak bangsa."`;

        const CSV_GURU = `ID,Username,Password,Nama,NIP,Mapel,Email,FotoURL
1,kepalasekolah,12345@,"Tentrem Lestari, S.Pd.",,Kepala Sekolah,lestari@sekolah.sch.id,https://i.postimg.cc/Vs2v3Dcg/1-TENTREM-LESTARI-S-Pd.png
2,gurukls1a,12345@,"Ita Khusnul Hidayah, S.Pd.",,Guru kelas 1A,ita@sekolah.sch.id,https://i.postimg.cc/VNTPdZgx/4-ITA-KHUSNUL-HIDAYAH-S-Pd.jpg
3,gurukls1b,12345@,"Indri Nurmala sari, S.Pd.",,Guru Kelas 1B,indri@sekolah.sch.id,https://i.postimg.cc/wTVKhjF2/11-INDRI-NURMALASARI-S-Pd.jpg
4,gurukls2a,12345@,"Uci Apriliyani, S.Pd.",,Guru Kelas 2A,uci@sekolah.sch.id,https://i.postimg.cc/Y065Dr7r/7-UCI-APRILIYANI-S-Pd.jpg
5,gurukls2b,12345@,"Dina Nur Afiyah, S.Pd.",,Guru Kelas 2B,Dina@sekolah.sch.id,https://i.postimg.cc/PxWLyDCL/Whats-App-Image-2025-03-05-at-12-07-28-removebg-preview.png
6,gurukls3a,12345@,"Kharis Budi Santoso, S.Pd.",,Guru Kelas 3A,kharis@sekolah.sch.id,https://i.postimg.cc/FFqSMMtg/Gemini-Generated-Image-z2460z2460z2460z.png
7,gurukls3b,12345@,"Yenining Tiyas, S.Pd.",,Guru Kelas 3B,Yeni@sekolah.sch.id,https://i.postimg.cc/sxs6XpFB/6-YENINING-TIYAS-S-Pd.jpg
8,gurukls4a,12345@,"Nuryasih, S.Pd.",,Guru Kelas 4A,Asih@sekolah.sch.id,https://i.postimg.cc/q7N9VX0V/2-NURYASIH-S-Pd.png
9,gurukls4b,12345@,"Bayu Prahastian, S.Pd.",199601212025211014,Guru Kelas 4B,bayu@sekolah.sch.id,https://i.postimg.cc/XYRgqwdv/12-BAYU-PRAHASTIAN-S-Pd.jpg
10,gurukls5a,12345@,"Idhi Agung Mulyawan, S.Pd.",,Guru Kelas 5A,idhi@sekolah.sch.id,https://i.postimg.cc/zfHPPzSJ/5-IDHI-AGUNG-MULYAWAN-S-Pd.jpg
11,gurukls5b,12345@,"Tuti Alawiyah, S.Pd.",,Guru Kelas 5B,tuti@sekolah.sch.id,https://via.placeholder.com/150`;

        const CSV_SISWA = `Kelas,L,P
Kelas 1 A,15,13
Kelas 1 B,15,13
Kelas 2 A,19,15
Kelas 2 B,19,15
Kelas 3 A,14,12
Kelas 3 B,14,13
Kelas 4 A,17,12
Kelas 4 B,18,11
Kelas 5 A,11,13
Kelas 5 B,13,11
Kelas 6 A,17,12
Kelas 6 B,19,12`;

        const CSV_MUTASI = `Kelas,L_Masuk,P_Masuk,L_Keluar,P_Keluar
Kelas 1,0,0,0,0
Kelas 2,1,0,0,0
Kelas 3,0,1,0,0
Kelas 4,0,0,0,1
Kelas 5,0,0,0,0
Kelas 6,0,0,0,0`;

        const CSV_FASILITAS = `Kategori,Nama,Keterangan,URL_Foto
Sapras,8 Ruang kelas,,
Sapras,1 Ruang guru,,
Sapras,1 Ruang KS,,
Sapras,1 Perpustakaan,,
Sapras,1 Musolah,,
Sapras,4 Wc siswa,,
Sapras,2 Wc guru,,
Sapras,1 Kantin,,
Sapras,1 Tempat parkir,,
Sapras,1 Uks,,
Sapras,1 lapangan voli,,
Ekstrakulikuler,Pramuka,,
Ekstrakulikuler,Rebana,,
Ekstrakulikuler,Tilawah,,
Ekstrakulikuler,Karate,,`;

        const CSV_GALERI = `Tipe,Judul,Link
Banner,Banner Utama,https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png
Banner,Banner Selamat Datang,https://via.placeholder.com/1200x600/0f172a/ffffff?text=Selamat+Datang+Siswa+Siswi+Baru
Foto,Kegiatan Ekologi,https://drive.google.com/file/d/1Q8Rh37RCM7ULwx55jqfAQrxGYjXuZGgT/view?usp=sharing
Foto,SOTK,https://via.placeholder.com/800x600?text=Upload+Gambar+SOTK+Disini`;

        const CSV_BERITA = `Judul,Tanggal,Isi,FotoURL
Selamat Datang,06/02/2026 22:47:26,Website resmi sekolah telah diluncurkan.,`;

        const CSV_DOWNLOADS = `NamaFile,Link,Kategori
Jadwal Pelajaran,,Akademik`;

        // --- PARSER HELPER ---
        function parseCSV(text) {
            const rows = [];
            let currentRow = [];
            let currentField = '';
            let inQuotes = false;
            
            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    currentRow.push(currentField.trim());
                    currentField = '';
                } else if ((char === '\n' || char === '\r') && !inQuotes) {
                    if (currentField || currentRow.length > 0) currentRow.push(currentField.trim());
                    if (currentRow.length > 0) rows.push(currentRow);
                    currentRow = [];
                    currentField = '';
                } else {
                    currentField += char;
                }
            }
            if (currentField || currentRow.length > 0) currentRow.push(currentField.trim());
            if (currentRow.length > 0) rows.push(currentRow);
            return rows.slice(1); // Skip Header
        }

        function parseConfig(text) {
            const rows = parseCSV(text);
            const config = {};
            rows.forEach(r => { if(r[0]) config[r[0]] = r[1]; });
            return config;
        }

        // --- GLOBAL DATA STORE ---
        let rawData = {
            config: parseConfig(CSV_CONFIG),
            guru: parseCSV(CSV_GURU),
            siswa: parseCSV(CSV_SISWA),
            mutasi: parseCSV(CSV_MUTASI),
            fasilitas: parseCSV(CSV_FASILITAS),
            galeri: parseCSV(CSV_GALERI),
            berita: parseCSV(CSV_BERITA),
            downloads: parseCSV(CSV_DOWNLOADS)
        };

        let isAdmin = false;

        // --- INIT ---
        window.addEventListener('load', () => {
            checkSession();
            renderAll(rawData);
            // SAFETY REMOVE LOADING (IN CASE OF ERROR)
            setTimeout(() => {
                const l = document.getElementById('loading');
                if(l) l.remove();
            }, 800);
        });

        // --- RENDER LOGIC ---
        function renderAll(d) {
            const c = d.config;

            // Config General
            if(c.LogoURL) {
                document.getElementById('nav-logo').src = c.LogoURL;
                document.getElementById('nav-logo').classList.remove('hidden');
            }
            document.getElementById('nav-nama-sekolah').innerText = c.NamaSekolah;
            document.getElementById('footer-nama').innerText = c.NamaSekolah;
            document.getElementById('hero-title').innerText = c.NamaSekolah.toUpperCase();
            document.getElementById('running-text-display').innerText = c.RunningText;
            document.getElementById('footer-alamat').innerText = c.Alamat;
            if(c.GoogleMapsEmbed) document.getElementById('maps-container').innerHTML = `<iframe src="${c.GoogleMapsEmbed}" width="100%" height="100%" style="border:0;" loading="lazy"></iframe>`;

            // Links (LMS & Medsos)
            if(c.LMS_Link && c.LMS_Link !== '#') {
                document.querySelectorAll('#btn-lms, #lms-mobile-link, #footer-lms').forEach(b => {
                    b.href = c.LMS_Link;
                    b.classList.remove('hidden');
                });
            }
            document.getElementById('link-fb').href = c.Facebook || "#";
            document.getElementById('link-ig').href = c.Instagram || "#";
            document.getElementById('link-yt').href = c.Youtube || "#";

            // SPMB Logic
            const spmbStatus = c.SPMB_Status || 'Tutup';
            const btnReg = document.getElementById('btn-spmb-register');
            const btnHero = document.getElementById('btn-hero-spmb');
            const badge = document.getElementById('spmb-status-badge');
            
            if(spmbStatus === 'Buka') {
                badge.className = "px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-green-500 text-white shadow-sm";
                badge.innerText = "‚úÖ PENDAFTARAN DIBUKA";
                btnReg.disabled = false;
                btnReg.innerText = "Isi Formulir Pendaftaran";
                btnReg.classList.remove('opacity-50', 'cursor-not-allowed');
                btnHero.href = "#spmb-section";
            } else {
                badge.className = "px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider bg-red-500 text-white shadow-sm";
                badge.innerText = "‚õî PENDAFTARAN DITUTUP";
                btnReg.disabled = true;
                btnReg.innerText = "Pendaftaran Ditutup";
                btnReg.classList.add('opacity-50', 'cursor-not-allowed');
                btnHero.onclick = (e) => { e.preventDefault(); alert('Maaf, Pendaftaran SPMB Sedang Ditutup.'); };
            }

            if(c.NoWaPPDB) {
                const url = `https://wa.me/${c.NoWaPPDB}`;
                document.getElementById('btn-spmb-wa').href = url;
                document.getElementById('footer-ppdb').href = url;
                document.getElementById('footer-ppdb').classList.remove('hidden');
            }

            // Slider
            const banners = d.galeri.filter(x => x[0] === 'Banner');
            const slider = document.getElementById('banner-slider');
            slider.innerHTML = banners.map((b, i) => `
                <div class="slide-item ${i===0?'active':''} bg-cover bg-center absolute inset-0" style="background-image: url('${b[2]}');">
                    <div class="absolute inset-0 bg-black/40"></div>
                </div>
            `).join('');
            if(banners.length > 1) {
                let curr = 0;
                setInterval(() => {
                    const items = document.querySelectorAll('.slide-item');
                    items[curr].classList.remove('active');
                    curr = (curr + 1) % items.length;
                    items[curr].classList.add('active');
                }, 5000);
            }

            // Guru & KS
            const ks = d.guru.find(g => g[5] && g[5].toLowerCase().includes('kepala')) || d.guru[0];
            if(ks) {
                document.getElementById('ks-nama').innerText = ks[3];
                document.getElementById('ks-nip').innerText = ks[4] || '-';
                document.getElementById('ks-foto').src = ks[7] || 'https://via.placeholder.com/300';
            }
            document.getElementById('ks-sambutan').innerText = `"${c.SambutanKS}"`;

            // Grid Guru (Exclude KS & Limit 10)
            const gurus = d.guru.filter(g => !g[5].toLowerCase().includes('kepala'));
            const displayGurus = gurus.slice(0, 10);
            document.getElementById('guru-grid').innerHTML = displayGurus.map(g => `
                <div class="bg-white rounded-xl p-4 text-center shadow-sm border border-slate-100 hover:shadow-md transition">
                    <div class="w-24 h-24 mx-auto rounded-full overflow-hidden mb-3 bg-slate-100">
                        <img src="${g[7]||'https://via.placeholder.com/150'}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/150'">
                    </div>
                    <h5 class="font-bold text-sm text-primary leading-tight mb-1">${g[3]}</h5>
                    <span class="text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-500 uppercase">${g[5]}</span>
                </div>
            `).join('');

            // Visi Misi
            document.getElementById('visi-text').innerText = c.Visi;
            document.getElementById('misi-list').innerHTML = c.Misi.split('\n').map(m => `<li><i class="fa-solid fa-check text-emerald-400 mr-2"></i>${m}</li>`).join('');

            // Siswa Stats
            let tL=0, tP=0;
            const tbody = document.getElementById('siswa-tbody');
            tbody.innerHTML = '';
            d.siswa.forEach(s => {
                const l = parseInt(s[1])||0, p = parseInt(s[2])||0;
                tL+=l; tP+=p;
                tbody.innerHTML += `<tr><td class="p-2 text-left font-medium">${s[0]}</td><td>${l}</td><td>${p}</td><td class="font-bold">${l+p}</td></tr>`;
            });
            document.getElementById('total-siswa').innerText = tL+tP;
            document.getElementById('total-lk').innerText = tL;
            document.getElementById('total-pr').innerText = tP;
            document.getElementById('total-rombel').innerText = d.siswa.length;

            new Chart(document.getElementById('genderChart'), {
                type: 'doughnut',
                data: { labels: ['L','P'], datasets:[{data:[tL, tP], backgroundColor:['#2563eb','#ec4899'], borderWidth:0}] },
                options: { plugins: { legend: { display: false } }, cutout: '70%' }
            });

            // Mutasi
            const mbody = document.getElementById('mutasi-tbody');
            mbody.innerHTML = '';
            d.mutasi.forEach(m => {
                mbody.innerHTML += `<tr><td class="p-2 font-medium">${m[0]}</td>
                <td class="bg-emerald-50 text-emerald-700 font-bold">${m[1]||0}</td><td class="bg-emerald-50 text-emerald-700 font-bold">${m[2]||0}</td>
                <td class="bg-rose-50 text-rose-700 font-bold">${m[3]||0}</td><td class="bg-rose-50 text-rose-700 font-bold">${m[4]||0}</td></tr>`;
            });

            // SOTK
            const sotk = d.galeri.find(g => g[1].toLowerCase().includes('sotk'));
            if(sotk) document.getElementById('sotk-container').innerHTML = `<img src="${sotk[2]}" class="w-full h-auto object-contain">`;

            // Fasilitas
            document.getElementById('fasilitas-grid').innerHTML = d.fasilitas.map(f => `
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-blue-50 text-accent flex items-center justify-center shrink-0">
                        <i class="fa-solid fa-check"></i>
                    </div>
                    <div class="text-left">
                        <h5 class="font-bold text-sm">${f[1]}</h5>
                        <p class="text-xs text-slate-400 uppercase">${f[0]}</p>
                    </div>
                </div>
            `).join('');

            // Berita
            document.getElementById('berita-list').innerHTML = d.berita.map(b => `
                <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                    <span class="text-xs text-accent font-bold">${b[1] || 'Info'}</span>
                    <h4 class="font-bold text-lg mt-1 mb-2">${b[0]}</h4>
                    <p class="text-sm text-slate-500">${b[2]}</p>
                </div>
            `).join('');
            
            // Downloads
            if(d.downloads.length > 0) {
                document.getElementById('download-list').innerHTML = d.downloads.map(dl => `
                    <li class="flex items-center gap-3 p-2 bg-slate-50 rounded hover:bg-slate-100 transition cursor-pointer">
                        <i class="fa-solid fa-file-pdf text-red-500"></i>
                        <div><p class="text-sm font-bold text-primary">${dl[0]}</p><p class="text-xs text-slate-400">${dl[2]}</p></div>
                    </li>`).join('');
            }
        }

        // --- ADMIN FUNCTIONS ---
        function checkSession() {
            const sess = localStorage.getItem('admin_session');
            if (sess) {
                const data = JSON.parse(sess);
                const now = new Date().getTime();
                if (now - data.time > 1800000) { // 30 Menit
                    alert("Sesi Admin Telah Habis.");
                    logout();
                } else {
                    localStorage.setItem('admin_session', JSON.stringify({ status: true, time: now }));
                    enableAdminMode();
                }
            }
        }

        function enableAdminMode() {
            isAdmin = true;
            document.body.classList.add('admin-mode');
            const btn = document.getElementById('btn-login');
            btn.innerHTML = '<i class="fa-solid fa-right-from-bracket text-red-500"></i>';
            btn.onclick = logout;
        }

        function doLogin(e) {
            e.preventDefault();
            const u = e.target.user.value;
            const p = e.target.pass.value;
            if(u === 'admin' && p === rawData.config.AdminPassword) {
                const now = new Date().getTime();
                localStorage.setItem('admin_session', JSON.stringify({ status: true, time: now }));
                location.reload();
            } else {
                alert("Password Salah!");
            }
        }

        function logout() {
            if(confirm("Keluar dari Panel Admin?")) {
                localStorage.removeItem('admin_session');
                location.reload();
            }
        }

        function handleLoginButton() {
            if(isAdmin) logout();
            else document.getElementById('modal-login').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('modal-admin').classList.add('hidden'); }
        function openAdminModal(tab) {
             document.getElementById('modal-admin').classList.remove('hidden');
             switchTab(tab);
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(e => e.classList.add('hidden'));
            document.getElementById(`tab-${t}`).classList.remove('hidden');
            
            // Populate Data
            if(t==='config') {
                document.getElementById('adm-nama').value = rawData.config.NamaSekolah;
                document.getElementById('adm-running').value = rawData.config.RunningText;
                document.getElementById('adm-lms').value = rawData.config.LMS_Link;
                document.getElementById('adm-wa').value = rawData.config.NoWaPPDB;
                document.getElementById('adm-spmb-status').value = rawData.config.SPMB_Status;
                document.getElementById('adm-fb').value = rawData.config.Facebook || '';
                document.getElementById('adm-ig').value = rawData.config.Instagram || '';
                document.getElementById('adm-yt').value = rawData.config.Youtube || '';
            }
            if(t==='mutasi') {
                document.getElementById('adm-list-mutasi').innerHTML = rawData.mutasi.map((m, i) => `
                    <tr>
                        <td class="p-2 font-bold bg-slate-50">${m[0]}</td>
                        <td class="p-2"><input type="number" value="${m[1]||0}" class="w-12 border p-1 rounded text-center" onchange="updateMutasi(${i}, 1, this.value)"></td>
                        <td class="p-2"><input type="number" value="${m[2]||0}" class="w-12 border p-1 rounded text-center" onchange="updateMutasi(${i}, 2, this.value)"></td>
                        <td class="p-2"><input type="number" value="${m[3]||0}" class="w-12 border p-1 rounded text-center" onchange="updateMutasi(${i}, 3, this.value)"></td>
                        <td class="p-2"><input type="number" value="${m[4]||0}" class="w-12 border p-1 rounded text-center" onchange="updateMutasi(${i}, 4, this.value)"></td>
                    </tr>
                `).join('');
            }
            if(t==='guru') {
                document.getElementById('adm-list-guru').innerHTML = rawData.guru.map(g => `<div class="border-b pb-2 mb-2 flex justify-between"><div><b>${g[3]}</b><br><small>${g[5]}</small></div><button class="text-red-500 text-xs" onclick="deleteItem('guru', '${g[3]}')">Hapus</button></div>`).join('');
            }
            if(t==='berita') {
                document.getElementById('adm-list-berita').innerHTML = rawData.berita.map(b => `<div class="border-b pb-2 mb-2 flex justify-between"><div><b>${b[0]}</b><br><small>${b[1]}</small></div><button class="text-red-500 text-xs" onclick="deleteItem('berita', '${b[0]}')">Hapus</button></div>`).join('');
            }
            if(t==='galeri') {
                document.getElementById('adm-list-galeri').innerHTML = rawData.galeri.map(g => `<div class="relative group border rounded h-20 overflow-hidden"><img src="${g[2]}" class="w-full h-full object-cover"><div class="absolute bottom-0 bg-black/50 text-white text-[10px] w-full p-1 truncate">${g[1]}</div><button class="absolute top-1 right-1 bg-red-600 text-white w-5 h-5 rounded-full text-xs flex items-center justify-center opacity-0 group-hover:opacity-100 transition" onclick="deleteItem('galeri', '${g[1]}')">x</button></div>`).join('');
            }
            if(t==='fasilitas') {
                document.getElementById('adm-list-fasilitas').innerHTML = rawData.fasilitas.map(f => `<div class="border-b pb-2 mb-2 flex justify-between"><div><b>${f[1]}</b><br><small>${f[0]}</small></div><button class="text-red-500 text-xs" onclick="deleteItem('fasilitas', '${f[1]}')">Hapus</button></div>`).join('');
            }
        }

        // --- CRUD ACTIONS ---
        function updateMutasi(rowIndex, colIndex, val) {
            rawData.mutasi[rowIndex][colIndex] = val;
            renderAll(rawData); 
        }

        function saveData(e, type) {
            e.preventDefault();
            if(type === 'config') {
                rawData.config.NamaSekolah = document.getElementById('adm-nama').value;
                rawData.config.RunningText = document.getElementById('adm-running').value;
                rawData.config.LMS_Link = document.getElementById('adm-lms').value;
                rawData.config.NoWaPPDB = document.getElementById('adm-wa').value;
                rawData.config.SPMB_Status = document.getElementById('adm-spmb-status').value;
                rawData.config.Facebook = document.getElementById('adm-fb').value;
                rawData.config.Instagram = document.getElementById('adm-ig').value;
                rawData.config.Youtube = document.getElementById('adm-yt').value;
                alert("Konfigurasi Disimpan!");
                renderAll(rawData);
                closeModal();
            }
        }

        function addItem(type) {
            if(type === 'guru') {
                const nama = prompt("Nama Guru:");
                const jabatan = prompt("Jabatan:");
                const foto = prompt("URL Foto (Kosongkan jika tidak ada):") || "";
                if(nama && jabatan) {
                    // ID, User, Pass, Nama, NIP, Mapel, Email, Foto
                    rawData.guru.push([Date.now(), "user", "pass", nama, "", jabatan, "", foto]);
                    alert("Guru Ditambahkan!");
                    switchTab('guru'); // Refresh list
                    renderAll(rawData);
                }
            } else if(type === 'berita') {
                const judul = prompt("Judul Berita:");
                const isi = prompt("Isi Singkat:");
                if(judul && isi) {
                    rawData.berita.unshift([judul, new Date().toLocaleString(), isi, ""]);
                    alert("Berita Ditambahkan!");
                    switchTab('berita');
                    renderAll(rawData);
                }
            } else if(type === 'galeri') {
                const tipe = prompt("Tipe (Banner/Foto/Video/SOTK):", "Foto");
                const judul = prompt("Judul/Keterangan:");
                const link = prompt("Link URL Gambar:");
                if(tipe && judul && link) {
                    rawData.galeri.push([tipe, judul, link]);
                    alert("Galeri Ditambahkan!");
                    switchTab('galeri');
                    renderAll(rawData);
                }
            } else if(type === 'fasilitas') {
                const nama = prompt("Nama Fasilitas:");
                const kategori = prompt("Kategori (Sapras/Ekstrakulikuler):", "Sapras");
                if(nama) {
                    rawData.fasilitas.push([kategori, nama, "", ""]);
                    alert("Fasilitas Ditambahkan!");
                    switchTab('fasilitas');
                    renderAll(rawData);
                }
            }
        }

        function deleteItem(type, key) {
            if(!confirm("Yakin ingin menghapus?")) return;
            
            if(type === 'guru') {
                rawData.guru = rawData.guru.filter(g => g[3] !== key);
                switchTab('guru');
            } else if(type === 'berita') {
                rawData.berita = rawData.berita.filter(b => b[0] !== key);
                switchTab('berita');
            } else if(type === 'galeri') {
                rawData.galeri = rawData.galeri.filter(g => g[1] !== key);
                switchTab('galeri');
            } else if(type === 'fasilitas') {
                rawData.fasilitas = rawData.fasilitas.filter(f => f[1] !== key);
                switchTab('fasilitas');
            }
            renderAll(rawData);
        }

        async function kirimSPMB(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Mengirim...';
            setTimeout(() => {
                alert("Pendaftaran Berhasil Dikirim!");
                document.getElementById('modal-spmb').classList.add('hidden');
                btn.innerHTML = "Kirim Pendaftaran";
            }, 1500);
        }

        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }
    </script>
</body>
</html>