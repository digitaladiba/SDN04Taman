<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistem Informasi Digital SDN 4 Taman</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { 
                        primary: '#0f172a', 
                        accent: '#2563eb', 
                        gold: '#fbbf24', 
                        emerald: '#10b981', 
                        rose: '#f43f5e'
                    }
                }
            }
        }
    </script>
    <style>
        .glass-nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        html { scroll-behavior: smooth; }
        
        /* Admin Controls */
        .admin-only { display: none !important; }
        body.admin-mode .admin-only { display: inline-flex !important; }
        body.admin-mode .admin-block { display: block !important; }
        
        /* Edit Overlay */
        .editable { position: relative; cursor: pointer; }
        .editable:hover::after {
            content: '✏️ Kelola';
            position: absolute; inset: 0; background: rgba(0,0,0,0.6);
            display: none; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 1.2rem; z-index: 20; border-radius: inherit;
        }
        body.admin-mode .editable:hover::after { display: flex; }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { height: 8px; width: 8px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans selection:bg-accent selection:text-white">

    <!-- NAVBAR -->
    <nav class="fixed w-full z-50 glass-nav border-b border-slate-200 shadow-sm" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20 items-center">
                <div class="flex items-center gap-3">
                    <img id="nav-logo" src="" alt="Logo" class="h-12 w-auto object-contain hidden">
                    <div class="leading-tight">
                        <h1 id="nav-nama-sekolah" class="text-xl font-bold text-primary">SDN 4 Taman</h1>
                        <p class="text-[10px] md:text-xs text-slate-500 font-bold tracking-widest uppercase">Berkarakter & Berprestasi</p>
                    </div>
                </div>
                
                <div class="hidden lg:flex space-x-6 items-center">
                    <a href="#beranda" class="nav-item text-sm font-semibold text-slate-600 hover:text-accent">Beranda</a>
                    <a href="#guru" class="nav-item text-sm font-semibold text-slate-600 hover:text-accent">Guru</a>
                    <a href="#data-siswa" class="nav-item text-sm font-semibold text-slate-600 hover:text-accent">Siswa</a>
                    <a href="#fasilitas" class="nav-item text-sm font-semibold text-slate-600 hover:text-accent">Fasilitas</a>
                    <a href="#berita" class="nav-item text-sm font-semibold text-slate-600 hover:text-accent">Berita</a>
                    
                    <a href="#" id="btn-lms" target="_blank" class="px-4 py-2 bg-orange-500 text-white text-sm font-bold rounded-lg hover:bg-orange-600 hidden">
                        <i class="fa-solid fa-laptop-code"></i> LMS
                    </a>

                    <button onclick="handleLoginButton()" id="btn-login" class="w-10 h-10 rounded-full bg-slate-100 hover:bg-accent hover:text-white flex items-center justify-center transition shadow-sm border border-slate-200">
                        <i class="fa-solid fa-lock text-xs"></i>
                    </button>
                </div>

                <button onclick="toggleMobileMenu()" class="lg:hidden text-slate-600 text-2xl"><i class="fa-solid fa-bars"></i></button>
            </div>
        </div>
        
        <!-- MOBILE MENU -->
        <div id="mobile-menu" class="hidden lg:hidden bg-white border-t p-4 space-y-3 shadow-xl max-h-[80vh] overflow-y-auto">
            <a href="#beranda" class="block font-medium text-slate-600 p-2">Beranda</a>
            <a href="#guru" class="block font-medium text-slate-600 p-2">Guru</a>
            <a href="#data-siswa" class="block font-medium text-slate-600 p-2">Data Siswa</a>
            <button onclick="handleLoginButton()" id="btn-login-mobile" class="w-full text-center font-bold text-slate-500 p-2 border border-slate-200 rounded mt-2">Login Admin</button>
        </div>
    </nav>

    <!-- STATUS BAR -->
    <div id="db-status" class="fixed bottom-4 left-4 z-[90] bg-white border border-slate-200 shadow-lg rounded-lg px-4 py-3 text-xs font-medium text-slate-600 flex flex-col gap-1 transition-all">
        <div class="flex items-center gap-2">
            <span class="w-2.5 h-2.5 rounded-full bg-yellow-400 animate-pulse" id="db-indicator"></span>
            <span id="db-text" class="font-bold">Menghubungkan Database...</span>
        </div>
        <div id="db-detail" class="text-[10px] text-slate-400">Mohon tunggu sebentar...</div>
        <button id="btn-retry" onclick="initApp()" class="hidden mt-1 bg-slate-100 text-accent px-2 py-1 rounded border border-slate-200">Coba Lagi</button>
    </div>

    <main class="pt-20">
        
        <!-- HERO -->
        <section id="beranda" class="relative w-full h-[450px] md:h-[600px] overflow-hidden bg-slate-900 group editable" onclick="if(isAdmin) openAdminModal('config')">
            <div id="hero-background" class="absolute inset-0 bg-cover bg-center transition-all duration-1000" style="background-image: url('https://i.postimg.cc/NfP9fBTD/Hijau-dan-Putih-Modern-Pengabdian-Kepada-Masyarakat-Benner.png');">
                <div class="absolute inset-0 bg-black/50"></div>
            </div>
            
            <div class="absolute inset-0 flex items-center justify-center z-20 text-center px-4">
                <div class="max-w-4xl">
                    <span class="inline-block py-1 px-4 rounded-full bg-white/20 text-white backdrop-blur-md border border-white/30 text-xs font-bold mb-6">OFFICIAL WEBSITE</span>
                    <h2 class="text-4xl md:text-6xl font-extrabold text-white mb-6 leading-tight drop-shadow-lg" id="hero-title">SDN 4 TAMAN</h2>
                    <div class="bg-black/30 backdrop-blur-sm rounded-lg p-3 mb-8 max-w-2xl mx-auto border border-white/10">
                         <p id="running-text-display" class="text-slate-200 text-lg">Selamat Datang...</p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-4 justify-center">
                        <a href="#spmb-section" id="btn-hero-spmb" class="px-8 py-3 bg-green-500 text-white font-bold rounded-full hover:bg-green-600 shadow-lg shadow-green-500/30">
                            Info SPMB
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- BANNER SLIDER -->
        <section class="bg-primary py-4 border-t-4 border-accent relative overflow-hidden">
            <div class="max-w-7xl mx-auto px-4 flex items-center gap-2 mb-2">
                <span class="w-2 h-8 bg-gold rounded-full"></span>
                <h3 class="text-white font-bold text-lg uppercase tracking-wider">Info & Banner</h3>
                <button onclick="openAdminModal('galeri')" class="admin-only ml-auto bg-white/10 text-white text-xs px-2 py-1 rounded hover:bg-white/20"><i class="fa-solid fa-pen"></i> Edit</button>
            </div>
            <div class="relative w-full overflow-hidden mt-2">
                <div id="banner-track" class="flex gap-4 px-4 overflow-x-auto no-scrollbar snap-x snap-mandatory py-2">
                    <div class="w-full text-center text-white/50 text-sm py-8">Memuat Banner...</div>
                </div>
            </div>
        </section>

        <!-- SAMBUTAN -->
        <section id="sambutan" class="py-20 bg-white relative editable" onclick="if(isAdmin) openAdminModal('config')">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row items-center gap-12">
                <div class="md:w-1/3 text-center">
                    <img id="ks-foto" src="" class="rounded-3xl shadow-2xl w-full max-w-xs mx-auto object-cover h-[450px] border-4 border-white bg-slate-200" onerror="this.src='https://via.placeholder.com/400x600?text=Foto+KS'">
                </div>
                <div class="md:w-2/3">
                    <span class="text-accent font-bold tracking-wider uppercase text-sm mb-2 block">Sambutan Kepala Sekolah</span>
                    <h2 class="text-3xl md:text-4xl font-bold text-primary mb-6">Assalamu'alaikum Warahmatullahi Wabarakatuh</h2>
                    <div class="prose prose-lg text-slate-600 mb-6 italic border-l-4 border-accent pl-6 py-2 bg-slate-50 rounded-r-lg">
                        <p id="ks-sambutan">"Pendidikan adalah tiket ke masa depan..."</p>
                    </div>
                    <h4 id="ks-nama" class="font-bold text-lg text-primary">Kepala Sekolah</h4>
                </div>
            </div>
        </section>

        <!-- DATA SISWA -->
        <section id="data-siswa" class="py-20 bg-slate-50">
            <div class="max-w-7xl mx-auto px-4">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center border">
                        <h3 id="total-siswa" class="text-3xl font-bold text-slate-800">0</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 mt-1">Total Siswa</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center border">
                        <h3 id="total-lk" class="text-3xl font-bold text-blue-600">0</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 mt-1">Laki-Laki</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm text-center border">
                        <h3 id="total-pr" class="text-3xl font-bold text-pink-500">0</h3>
                        <p class="text-[10px] uppercase font-bold text-slate-400 mt-1">Perempuan</p>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-8">
                    <!-- Rombel -->
                    <div class="bg-white rounded-2xl shadow-sm border p-4 editable" onclick="if(isAdmin) openAdminModal('siswa')">
                         <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold text-primary">Data Rombel</h4>
                            <span class="admin-only text-xs bg-slate-100 px-2 py-1 rounded">Klik untuk Edit</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-center">
                                <thead class="bg-slate-100 text-xs uppercase font-bold"><tr><th class="p-2 text-left">Kelas</th><th>L</th><th>P</th><th>JML</th></tr></thead>
                                <tbody id="siswa-tbody" class="divide-y"></tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Mutasi -->
                    <div class="bg-white rounded-2xl shadow-sm border p-4 editable" onclick="if(isAdmin) openAdminModal('mutasi')">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold text-primary">Data Mutasi</h4>
                            <span class="admin-only text-xs bg-slate-100 px-2 py-1 rounded">Klik untuk Edit</span>
                        </div>
                         <div class="overflow-x-auto">
                            <table class="w-full text-sm text-center">
                                <thead class="bg-slate-100 text-xs uppercase font-bold">
                                    <tr><th class="p-2 text-left">Kelas</th><th class="text-green-600">Masuk</th><th class="text-red-600">Keluar</th></tr>
                                </thead>
                                <tbody id="mutasi-tbody" class="divide-y"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- GURU -->
        <section id="guru" class="py-20 bg-slate-50 relative border-t">
            <button onclick="openAdminModal('guru')" class="admin-only absolute top-8 right-8 bg-accent text-white px-4 py-2 rounded shadow text-sm font-bold"><i class="fa-solid fa-cog mr-2"></i> Kelola Guru</button>
            <div class="max-w-7xl mx-auto px-4">
                <div class="text-center mb-12">
                    <h2 class="text-3xl font-bold text-primary">Guru dan Staf</h2>
                    <p class="text-slate-500">Pendidik Profesional SDN 4 Taman</p>
                </div>
                <div id="guru-container" class="flex gap-6 overflow-x-auto pb-8 px-4 snap-x custom-scroll"></div>
                
                <!-- SOTK -->
                <div id="sotk" class="mt-16 bg-white p-8 rounded-2xl shadow-sm border text-center editable" onclick="if(isAdmin) openAdminModal('galeri')">
                    <h3 class="text-xl font-bold mb-6">Struktur Organisasi</h3>
                    <div id="sotk-container" class="flex justify-center"><p class="text-slate-400">Memuat SOTK...</p></div>
                </div>
            </div>
        </section>

        <!-- FASILITAS -->
        <section id="fasilitas" class="py-20 bg-white relative editable" onclick="if(isAdmin) openAdminModal('fasilitas')">
            <button onclick="openAdminModal('fasilitas')" class="admin-only absolute top-8 right-8 bg-accent text-white px-4 py-2 rounded shadow text-sm font-bold"><i class="fa-solid fa-cog mr-2"></i> Kelola Fasilitas</button>
            <div class="max-w-7xl mx-auto px-4 text-center">
                 <h2 class="text-3xl font-bold text-primary mb-8">Fasilitas & Ekstrakurikuler</h2>
                 <div id="fasilitas-grid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </div>
        </section>

        <!-- BERITA -->
        <section id="berita" class="py-20 bg-slate-50 border-t relative">
            <button onclick="openAdminModal('berita')" class="admin-only absolute top-8 right-8 bg-emerald-500 text-white px-4 py-2 rounded shadow text-sm font-bold"><i class="fa-solid fa-plus mr-2"></i> Tambah Berita</button>
            <div class="max-w-7xl mx-auto px-4">
                <h2 class="text-3xl font-bold text-primary mb-8">Berita Terkini</h2>
                <div id="berita-list" class="grid md:grid-cols-2 gap-6"></div>
            </div>
        </section>

        <!-- SPMB & DOWNLOAD -->
        <section id="spmb-section" class="py-20 bg-blue-50 border-t border-slate-200">
            <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-3 gap-12">
                <!-- Downloads -->
                <div class="md:col-span-1 bg-white p-6 rounded-2xl shadow-sm border h-fit relative">
                    <button onclick="openAdminModal('downloads')" class="admin-only absolute top-2 right-2 text-xs bg-slate-100 px-2 py-1 rounded">Edit</button>
                    <h3 class="font-bold text-primary mb-4 flex items-center border-b pb-2"><i class="fa-solid fa-download mr-2 text-emerald-500"></i> Download Area</h3>
                    <ul id="download-list" class="space-y-3 text-sm"></ul>
                </div>

                <!-- SPMB -->
                <div class="md:col-span-2 bg-gradient-to-br from-accent to-blue-600 rounded-2xl p-8 text-white shadow-xl relative overflow-hidden">
                    <div class="relative z-10">
                        <h3 class="font-bold text-3xl mb-2">SPMB Online</h3>
                        <p class="text-blue-100 mb-6">Penerimaan Murid Baru</p>
                        <div class="flex items-center gap-4 mb-6">
                            <span id="spmb-status-badge" class="px-4 py-1 rounded-full text-xs font-bold uppercase bg-slate-500 text-white">Loading...</span>
                        </div>
                        <div class="flex gap-4 flex-wrap">
                            <button id="btn-spmb-register" onclick="document.getElementById('modal-spmb').classList.remove('hidden')" class="px-6 py-3 bg-white text-accent font-bold rounded-lg disabled:opacity-50">Isi Formulir</button>
                            <a href="#" id="btn-spmb-wa" target="_blank" class="px-6 py-3 bg-green-500 text-white font-bold rounded-lg flex items-center"><i class="fa-brands fa-whatsapp mr-2"></i> Chat Panitia</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="bg-primary text-white pt-16 pb-8 border-t-4 border-accent relative editable" onclick="if(isAdmin) openAdminModal('config')">
            <div class="max-w-7xl mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-12 mb-12">
                <div>
                    <h3 class="font-bold text-xl mb-4" id="footer-nama">SDN 4 Taman</h3>
                    <p class="text-sm text-slate-400 mb-4" id="footer-alamat">Alamat...</p>
                    <div class="flex gap-4">
                        <a href="#" id="link-fb" target="_blank"><i class="fa-brands fa-facebook fa-lg"></i></a>
                        <a href="#" id="link-ig" target="_blank"><i class="fa-brands fa-instagram fa-lg"></i></a>
                        <a href="#" id="link-yt" target="_blank"><i class="fa-brands fa-youtube fa-lg"></i></a>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold mb-4">Link Pintas</h3>
                    <ul class="text-sm space-y-2 text-slate-400">
                        <li><a href="#guru">Guru</a></li>
                        <li><a href="#data-siswa">Siswa</a></li>
                    </ul>
                </div>
                <div class="h-48 bg-slate-800 rounded-lg overflow-hidden" id="maps-container"></div>
            </div>
            <div class="text-center text-xs text-slate-500 pt-8 border-t border-slate-800">&copy; 2026 SDN 4 Taman.</div>
        </footer>
    </main>

    <!-- === ADMIN DASHBOARD MODAL === -->
    <div id="modal-admin" class="fixed inset-0 bg-black/50 hidden z-[70] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-xl w-full max-w-6xl h-[90vh] flex flex-col shadow-2xl overflow-hidden">
            <!-- Header -->
            <div class="p-4 border-b flex justify-between items-center bg-slate-50">
                <div class="flex items-center gap-2">
                    <div class="w-8 h-8 rounded-full bg-accent text-white flex items-center justify-center"><i class="fa-solid fa-user-gear"></i></div>
                    <h3 class="font-bold text-lg text-primary">Admin Dashboard</h3>
                </div>
                <button onclick="closeModal()" class="text-slate-400 hover:text-red-500 text-xl"><i class="fa-solid fa-times"></i></button>
            </div>
            
            <div class="flex flex-1 overflow-hidden">
                <!-- Sidebar -->
                <div class="w-64 bg-slate-50 border-r p-4 space-y-1 overflow-y-auto hidden md:block">
                    <button onclick="switchTab('config')" class="admin-tab w-full text-left px-4 py-3 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm transition flex items-center gap-2"><i class="fa-solid fa-cogs w-5"></i> Konfigurasi</button>
                    <button onclick="switchTab('guru')" class="admin-tab w-full text-left px-4 py-3 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm transition flex items-center gap-2"><i class="fa-solid fa-chalkboard-user w-5"></i> Data Guru</button>
                    <button onclick="switchTab('siswa')" class="admin-tab w-full text-left px-4 py-3 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm transition flex items-center gap-2"><i class="fa-solid fa-users w-5"></i> Siswa & Mutasi</button>
                    <button onclick="switchTab('berita')" class="admin-tab w-full text-left px-4 py-3 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm transition flex items-center gap-2"><i class="fa-solid fa-newspaper w-5"></i> Berita</button>
                    <button onclick="switchTab('fasilitas')" class="admin-tab w-full text-left px-4 py-3 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm transition flex items-center gap-2"><i class="fa-solid fa-building w-5"></i> Fasilitas</button>
                    <button onclick="switchTab('galeri')" class="admin-tab w-full text-left px-4 py-3 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm transition flex items-center gap-2"><i class="fa-solid fa-images w-5"></i> Galeri & Banner</button>
                    <button onclick="switchTab('downloads')" class="admin-tab w-full text-left px-4 py-3 rounded-lg text-sm font-medium hover:bg-white hover:shadow-sm transition flex items-center gap-2"><i class="fa-solid fa-download w-5"></i> File Download</button>
                    <button onclick="doLogout()" class="w-full text-left px-4 py-3 rounded-lg text-sm font-bold text-red-600 hover:bg-red-50 mt-8 flex items-center gap-2"><i class="fa-solid fa-sign-out-alt w-5"></i> Logout</button>
                </div>

                <!-- Content Area -->
                <div class="flex-1 p-6 overflow-y-auto bg-white" id="modal-content">
                    
                    <!-- TAB CONFIG -->
                    <div id="tab-config" class="tab-content">
                        <h4 class="font-bold text-xl mb-6 pb-2 border-b">Pengaturan Umum</h4>
                        <form onsubmit="saveData(event, 'config')" class="grid md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <h5 class="font-bold text-accent text-sm uppercase">Identitas Sekolah</h5>
                                <div><label class="label">Nama Sekolah</label><input id="adm-NamaSekolah" class="input-field"></div>
                                <div><label class="label">Running Text</label><input id="adm-RunningText" class="input-field"></div>
                                <div><label class="label">Alamat Footer</label><textarea id="adm-Alamat" class="input-field h-24"></textarea></div>
                                <div><label class="label">Foto Utama (URL)</label><input id="adm-MainImage" class="input-field" placeholder="https://..."></div>
                            </div>
                            <div class="space-y-4">
                                <h5 class="font-bold text-accent text-sm uppercase">Kepala Sekolah & Sosmed</h5>
                                <div><label class="label">Sambutan KS</label><textarea id="adm-SambutanKS" class="input-field h-24"></textarea></div>
                                <div><label class="label">Link Facebook</label><input id="adm-Facebook" class="input-field"></div>
                                <div><label class="label">Link Instagram</label><input id="adm-Instagram" class="input-field"></div>
                                <div><label class="label">SPMB Status</label>
                                    <select id="adm-SPMB_Status" class="input-field">
                                        <option value="Buka">Buka</option><option value="Tutup">Tutup</option>
                                    </select>
                                </div>
                                <button type="submit" class="w-full bg-primary text-white py-3 rounded-lg font-bold mt-4">Simpan Konfigurasi</button>
                            </div>
                        </form>
                    </div>

                    <!-- TAB GURU -->
                    <div id="tab-guru" class="tab-content hidden">
                        <div class="flex justify-between mb-4">
                            <h4 class="font-bold text-xl">Data Guru</h4>
                            <button onclick="openForm('Guru')" class="btn-add">+ Tambah Guru</button>
                        </div>
                        <div class="overflow-x-auto border rounded-lg"><table class="w-full text-sm text-left"><thead class="bg-slate-50 border-b"><tr><th class="p-3">Nama</th><th class="p-3">Jabatan</th><th class="p-3 text-center">Aksi</th></tr></thead><tbody id="list-Guru"></tbody></table></div>
                    </div>

                    <!-- TAB SISWA -->
                    <div id="tab-siswa" class="tab-content hidden">
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h4 class="font-bold text-lg mb-4">Data Siswa (Per Kelas)</h4>
                                <table class="w-full text-sm text-center border rounded-lg mb-4">
                                    <thead class="bg-slate-100"><tr><th class="p-2">Kelas</th><th>L</th><th>P</th></tr></thead>
                                    <tbody id="list-Siswa"></tbody>
                                </table>
                                <button onclick="saveBulk('Siswa')" class="btn-save w-full">Simpan Data Siswa</button>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg mb-4">Data Mutasi</h4>
                                <table class="w-full text-sm text-center border rounded-lg mb-4">
                                    <thead class="bg-slate-100"><tr><th class="p-2">Kelas</th><th>L In</th><th>P In</th><th>L Out</th><th>P Out</th></tr></thead>
                                    <tbody id="list-Mutasi"></tbody>
                                </table>
                                <button onclick="saveBulk('Mutasi')" class="btn-save w-full">Simpan Data Mutasi</button>
                            </div>
                        </div>
                    </div>

                    <!-- TAB BERITA -->
                    <div id="tab-berita" class="tab-content hidden">
                        <div class="flex justify-between mb-4">
                            <h4 class="font-bold text-xl">Berita Sekolah</h4>
                            <button onclick="openForm('Berita')" class="btn-add">+ Tulis Berita</button>
                        </div>
                        <div class="grid grid-cols-1 gap-4" id="list-Berita"></div>
                    </div>

                    <!-- TAB GALERI -->
                    <div id="tab-galeri" class="tab-content hidden">
                         <div class="flex justify-between mb-4">
                            <h4 class="font-bold text-xl">Galeri, Banner & SOTK</h4>
                            <button onclick="openForm('Galeri')" class="btn-add">+ Upload Gambar</button>
                        </div>
                        <div class="bg-blue-50 p-3 text-sm rounded mb-4">Tips: Untuk Slider Depan pilih tipe <b>Banner</b>. Untuk SOTK, isi judul dengan <b>SOTK</b>.</div>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="list-Galeri"></div>
                    </div>

                    <!-- TAB FASILITAS -->
                    <div id="tab-fasilitas" class="tab-content hidden">
                         <div class="flex justify-between mb-4">
                            <h4 class="font-bold text-xl">Fasilitas & Ekskul</h4>
                            <button onclick="openForm('Fasilitas')" class="btn-add">+ Tambah</button>
                        </div>
                        <div class="overflow-x-auto border rounded-lg"><table class="w-full text-sm text-left"><thead class="bg-slate-50 border-b"><tr><th class="p-3">Kategori</th><th class="p-3">Nama</th><th class="p-3 text-center">Aksi</th></tr></thead><tbody id="list-Fasilitas"></tbody></table></div>
                    </div>

                    <!-- TAB DOWNLOADS -->
                    <div id="tab-downloads" class="tab-content hidden">
                        <div class="flex justify-between mb-4">
                           <h4 class="font-bold text-xl">File Downloads</h4>
                           <button onclick="openForm('Downloads')" class="btn-add">+ Tambah File</button>
                       </div>
                       <div class="overflow-x-auto border rounded-lg"><table class="w-full text-sm text-left"><thead class="bg-slate-50 border-b"><tr><th class="p-3">Nama File</th><th class="p-3">Link</th><th class="p-3 text-center">Aksi</th></tr></thead><tbody id="list-Downloads"></tbody></table></div>
                   </div>

                </div>
            </div>
        </div>
    </div>

    <!-- === UNIVERSAL FORM MODAL === -->
    <div id="modal-form" class="fixed inset-0 bg-black/60 hidden z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 shadow-2xl relative">
            <button onclick="closeForm()" class="absolute top-4 right-4 text-slate-400 hover:text-red-500"><i class="fa-solid fa-times"></i></button>
            <h3 id="form-title" class="text-xl font-bold text-primary mb-4">Edit Data</h3>
            <form id="dynamic-form" onsubmit="submitForm(event)" class="space-y-3">
                <input type="hidden" id="f-id">
                <input type="hidden" id="f-type">
                <div id="form-fields" class="space-y-3"></div>
                <button type="submit" class="w-full bg-accent text-white font-bold py-3 rounded-lg mt-4 hover:bg-blue-600">Simpan Data</button>
            </form>
        </div>
    </div>

    <!-- LOGIN MODAL -->
    <div id="modal-login" class="fixed inset-0 bg-black/80 hidden z-[80] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-sm w-full p-6 relative">
            <button onclick="document.getElementById('modal-login').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold text-primary mb-4">Login Admin</h3>
            <form onsubmit="doLogin(event)">
                <input type="text" name="user" placeholder="Username" class="input-field mb-3" required>
                <input type="password" name="pass" placeholder="Password" class="input-field mb-4" required>
                <button type="submit" class="w-full bg-primary text-white font-bold py-3 rounded-lg">Masuk</button>
            </form>
        </div>
    </div>

    <!-- SPMB FORM -->
    <div id="modal-spmb" class="fixed inset-0 bg-black/80 hidden z-[90] flex items-center justify-center p-4">
        <div class="bg-white rounded-xl max-w-md w-full p-6 relative">
            <button onclick="document.getElementById('modal-spmb').classList.add('hidden')" class="absolute top-4 right-4 text-slate-400"><i class="fa-solid fa-times"></i></button>
            <h3 class="text-xl font-bold text-primary mb-1">Formulir SPMB</h3>
            <p class="text-sm text-slate-500 mb-4">Data Calon Murid Baru</p>
            <form onsubmit="kirimSPMB(event)" class="space-y-3">
                <input type="text" name="nama" placeholder="Nama Lengkap Siswa" class="input-field" required>
                <input type="text" name="nik" placeholder="NIK" class="input-field" required>
                <input type="text" name="hp" placeholder="No HP Orang Tua (WA)" class="input-field" required>
                <button type="submit" class="w-full bg-green-500 text-white font-bold py-3 rounded hover:bg-green-600">Kirim Pendaftaran</button>
            </form>
        </div>
    </div>

    <style>
        .input-field { width: 100%; padding: 0.5rem; border: 1px solid #cbd5e1; border-radius: 0.5rem; font-size: 0.875rem; }
        .label { font-size: 0.75rem; font-weight: 700; color: #64748b; margin-bottom: 0.25rem; display: block; }
        .btn-add { background: #2563eb; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; }
        .btn-save { background: #0f172a; color: white; padding: 0.5rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem; }
        .action-btn { padding: 0.25rem 0.5rem; border-radius: 0.25rem; font-size: 0.75rem; margin: 0 0.1rem; }
    </style>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyoK8WJlSqQf5F1coGww4AjtY5jB1PToCwuePPGn2mmXkadb3figgON9EnozYJL5In3UQ/exec"; 
        
        let rawData = {}; 
        let isAdmin = false;

        // INIT
        window.onload = function() {
            initApp();
            startBannerScroll();
        };

        async function initApp() {
            try {
                const res = await fetch(API_URL + '?action=getPublicData');
                const json = await res.json();
                if(json.status === 'success') {
                    rawData = json;
                    renderPublicUI(rawData);
                    document.getElementById('db-status').classList.add('opacity-0', 'pointer-events-none');
                } else { throw new Error(json.message); }
            } catch(e) {
                document.getElementById('db-text').innerText = "Mode Offline / Error";
                document.getElementById('db-indicator').classList.replace('bg-yellow-400','bg-red-500');
                console.error(e);
            }
        }

        // --- RENDER UI PUBLIK ---
        function renderPublicUI(d) {
            const c = d.config || {};
            // Text Config
            setText('nav-nama-sekolah', c.NamaSekolah);
            setText('footer-nama', c.NamaSekolah);
            setText('hero-title', c.NamaSekolah ? c.NamaSekolah.toUpperCase() : null);
            setText('running-text-display', c.RunningText);
            setText('footer-alamat', c.Alamat);
            setText('ks-sambutan', c.SambutanKS ? `"${c.SambutanKS}"` : null);
            
            // Images
            if(c.MainImage) document.getElementById('hero-background').style.backgroundImage = `url('${c.MainImage}')`;
            
            // Guru (Public)
            const gurus = (d.guru || []).filter(g => !String(g[5]).toLowerCase().includes('kepala'));
            const ks = (d.guru || []).find(g => String(g[5]).toLowerCase().includes('kepala'));
            
            if(ks) {
                setText('ks-nama', ks[3]);
                if(ks[7]) document.getElementById('ks-foto').src = ks[7];
            }
            
            document.getElementById('guru-container').innerHTML = gurus.map(g => `
                <div class="snap-center shrink-0 w-64 bg-white rounded-xl p-4 text-center shadow-sm border border-slate-100">
                    <div class="w-24 h-24 mx-auto rounded-full overflow-hidden mb-3 bg-slate-100">
                        <img src="${g[7] || 'https://via.placeholder.com/150'}" class="w-full h-full object-cover">
                    </div>
                    <h5 class="font-bold text-sm text-primary truncate">${g[3]}</h5>
                    <span class="text-[10px] bg-slate-100 px-2 py-0.5 rounded text-slate-500">${g[5]}</span>
                </div>
            `).join('');

            // Siswa
            let tL=0, tP=0;
            document.getElementById('siswa-tbody').innerHTML = (d.siswa||[]).map(s => {
                const l=parseInt(s[1])||0, p=parseInt(s[2])||0; tL+=l; tP+=p;
                return `<tr><td class="p-2 text-left font-medium border-b">${s[0]}</td><td class="border-b font-bold text-blue-600">${l}</td><td class="border-b font-bold text-pink-500">${p}</td><td class="border-b font-bold bg-slate-50">${l+p}</td></tr>`;
            }).join('');
            setText('total-siswa', tL+tP); setText('total-lk', tL); setText('total-pr', tP);

            // Mutasi
            document.getElementById('mutasi-tbody').innerHTML = (d.mutasi||[]).map(m => `
                <tr><td class="p-2 border-r text-left">${m[0]}</td><td class="bg-green-50 text-green-700 font-bold border-r">${m[1]||0}</td><td class="bg-green-50 text-green-700 font-bold border-r">${m[2]||0}</td><td class="bg-red-50 text-red-700 font-bold border-r">${m[3]||0}</td><td class="bg-red-50 text-red-700 font-bold">${m[4]||0}</td></tr>
            `).join('');

            // Berita
            document.getElementById('berita-list').innerHTML = (d.berita||[]).slice(0,4).map(b => `
                <div class="bg-white p-4 rounded-xl shadow-sm border">
                    <div class="flex gap-4">
                        <img src="${b[4] || 'https://via.placeholder.com/100'}" class="w-20 h-20 rounded object-cover bg-slate-200 shrink-0">
                        <div>
                            <span class="text-xs text-accent font-bold">${b[2] || '-'}</span>
                            <h4 class="font-bold mt-1 line-clamp-2">${b[1]}</h4>
                            <p class="text-xs text-slate-500 mt-1 line-clamp-2">${b[3]}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            // Fasilitas
            document.getElementById('fasilitas-grid').innerHTML = (d.fasilitas||[]).map(f => `
                <div class="bg-white p-4 rounded-xl shadow-sm border flex items-center gap-3">
                    <img src="${f[3]||'https://via.placeholder.com/50'}" class="w-10 h-10 rounded object-cover bg-slate-100">
                    <div class="text-left"><h5 class="font-bold text-sm">${f[2]}</h5><p class="text-xs text-slate-400">${f[1]}</p></div>
                </div>
            `).join('');

            // Downloads
            document.getElementById('download-list').innerHTML = (d.downloads||[]).map(f => `
                <li class="flex items-center gap-2 border-b pb-2 last:border-0"><i class="fa-solid fa-file-pdf text-red-500"></i> <a href="${f[3]}" target="_blank" class="text-slate-600 hover:text-accent font-medium flex-1 truncate">${f[1]}</a></li>
            `).join('');

            // Galeri / Banner / SOTK
            const sotk = (d.galeri||[]).find(g => String(g[2]).toLowerCase().includes('sotk'));
            if(sotk && sotk[3]) document.getElementById('sotk-container').innerHTML = `<img src="${sotk[3]}" class="w-full rounded-lg shadow">`;

            const banners = (d.galeri||[]).filter(g => String(g[1]).toLowerCase() === 'banner');
            document.getElementById('banner-track').innerHTML = banners.length ? banners.map(b => `
                 <div class="shrink-0 snap-center w-[300px] h-[180px] rounded-xl overflow-hidden relative group">
                    <img src="${b[3]}" class="w-full h-full object-cover">
                    <div class="absolute bottom-0 w-full bg-black/50 p-2 text-white text-xs truncate">${b[2]}</div>
                 </div>`).join('') : '<div class="w-full text-center text-white/50 py-4">Belum ada banner</div>';

            // SPMB
            const status = c.SPMB_Status || 'Tutup';
            const badge = document.getElementById('spmb-status-badge');
            badge.innerText = status === 'Buka' ? '✅ PENDAFTARAN DIBUKA' : '⛔ DITUTUP';
            badge.className = `px-4 py-1 rounded-full text-xs font-bold uppercase ${status === 'Buka' ? 'bg-green-500' : 'bg-red-500'} text-white`;
        }

        function setText(id, val) { if(val && document.getElementById(id)) document.getElementById(id).innerText = val; }

        // --- ADMIN & CRUD LOGIC ---
        async function doLogin(e) {
            e.preventDefault();
            const u = e.target.user.value;
            const p = e.target.pass.value;
            try {
                const res = await fetch(`${API_URL}?action=login&user=${u}&pass=${p}`);
                const json = await res.json();
                if(json.status === 'success') {
                    isAdmin = true;
                    document.body.classList.add('admin-mode');
                    document.getElementById('modal-login').classList.add('hidden');
                    alert("Login Berhasil!");
                } else { alert("Password Salah"); }
            } catch(e) { alert("Error Login"); }
        }

        function doLogout() { location.reload(); }
        function openAdminModal(tab) { document.getElementById('modal-admin').classList.remove('hidden'); switchTab(tab); }
        function closeModal() { document.getElementById('modal-admin').classList.add('hidden'); }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
            renderAdminData(tab);
        }

        // --- RENDER DATA DI ADMIN ---
        function renderAdminData(tab) {
            // Render Config
            if(tab === 'config') {
                const c = rawData.config || {};
                Object.keys(c).forEach(k => {
                    const el = document.getElementById(`adm-${k}`);
                    if(el) el.value = c[k];
                });
            }
            // Render Guru
            if(tab === 'guru') {
                const tbody = document.getElementById('list-Guru');
                tbody.innerHTML = (rawData.guru||[]).map(item => `
                    <tr class="border-b hover:bg-slate-50">
                        <td class="p-3">${item[3]}</td>
                        <td class="p-3 text-slate-500 text-xs">${item[5]}</td>
                        <td class="p-3 text-center">
                            <button onclick='openForm("Guru", ${JSON.stringify(item)})' class="action-btn bg-yellow-400 text-white"><i class="fa-solid fa-pen"></i></button>
                            <button onclick='deleteItem("Guru", "${item[0]}")' class="action-btn bg-red-500 text-white"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `).join('');
            }
            // Render Siswa (Bulk Input)
            if(tab === 'siswa') {
                const sBody = document.getElementById('list-Siswa');
                sBody.innerHTML = (rawData.siswa||[]).map((s,i) => `
                    <tr><td class="p-2 border font-bold bg-slate-50">${s[0]}</td>
                    <td class="p-1 border"><input value="${s[1]}" id="sis-l-${i}" class="w-12 text-center border rounded"></td>
                    <td class="p-1 border"><input value="${s[2]}" id="sis-p-${i}" class="w-12 text-center border rounded"></td></tr>
                `).join('');
                
                const mBody = document.getElementById('list-Mutasi');
                mBody.innerHTML = (rawData.mutasi||[]).map((m,i) => `
                    <tr><td class="p-2 border font-bold bg-slate-50">${m[0]}</td>
                    <td class="p-1 border"><input value="${m[1]}" id="mut-1-${i}" class="w-8 text-center border rounded bg-green-50"></td>
                    <td class="p-1 border"><input value="${m[2]}" id="mut-2-${i}" class="w-8 text-center border rounded bg-green-50"></td>
                    <td class="p-1 border"><input value="${m[3]}" id="mut-3-${i}" class="w-8 text-center border rounded bg-red-50"></td>
                    <td class="p-1 border"><input value="${m[4]}" id="mut-4-${i}" class="w-8 text-center border rounded bg-red-50"></td></tr>
                `).join('');
            }
            // Render Berita
            if(tab === 'berita') {
                document.getElementById('list-Berita').innerHTML = (rawData.berita||[]).map(b => `
                    <div class="border rounded-lg p-3 flex justify-between items-center bg-slate-50">
                        <div><h5 class="font-bold text-sm">${b[1]}</h5><p class="text-xs text-slate-400">${b[2]}</p></div>
                        <div class="flex">
                            <button onclick='openForm("Berita", ${JSON.stringify(b)})' class="action-btn bg-yellow-400 text-white"><i class="fa-solid fa-pen"></i></button>
                            <button onclick='deleteItem("Berita", "${b[0]}")' class="action-btn bg-red-500 text-white"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>`).join('');
            }
            // Render Galeri
            if(tab === 'galeri') {
                document.getElementById('list-Galeri').innerHTML = (rawData.galeri||[]).map(g => `
                    <div class="relative group border rounded overflow-hidden h-32">
                        <img src="${g[3]}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black/60 hidden group-hover:flex flex-col items-center justify-center text-white">
                            <span class="text-xs mb-2">${g[1]}</span>
                            <div>
                                <button onclick='openForm("Galeri", ${JSON.stringify(g)})' class="bg-yellow-400 p-1 rounded text-xs"><i class="fa-solid fa-pen"></i></button>
                                <button onclick='deleteItem("Galeri", "${g[0]}")' class="bg-red-500 p-1 rounded text-xs"><i class="fa-solid fa-trash"></i></button>
                            </div>
                        </div>
                    </div>`).join('');
            }
            // Render Fasilitas
            if(tab === 'fasilitas') {
                document.getElementById('list-Fasilitas').innerHTML = (rawData.fasilitas||[]).map(f => `
                    <tr class="border-b"><td class="p-3">${f[1]}</td><td class="p-3 font-bold">${f[2]}</td>
                    <td class="p-3 text-center"><button onclick='openForm("Fasilitas", ${JSON.stringify(f)})' class="action-btn bg-yellow-400 text-white"><i class="fa-solid fa-pen"></i></button><button onclick='deleteItem("Fasilitas", "${f[0]}")' class="action-btn bg-red-500 text-white"><i class="fa-solid fa-trash"></i></button></td></tr>
                `).join('');
            }
             // Render Downloads
             if(tab === 'downloads') {
                document.getElementById('list-Downloads').innerHTML = (rawData.downloads||[]).map(d => `
                    <tr class="border-b"><td class="p-3">${d[1]}</td><td class="p-3 text-blue-500 truncate max-w-[150px]">${d[3]}</td>
                    <td class="p-3 text-center"><button onclick='openForm("Downloads", ${JSON.stringify(d)})' class="action-btn bg-yellow-400 text-white"><i class="fa-solid fa-pen"></i></button><button onclick='deleteItem("Downloads", "${d[0]}")' class="action-btn bg-red-500 text-white"><i class="fa-solid fa-trash"></i></button></td></tr>
                `).join('');
            }
        }

        // --- FORM LOGIC (DINAMIS) ---
        function openForm(type, data = null) {
            document.getElementById('modal-form').classList.remove('hidden');
            document.getElementById('form-title').innerText = data ? `Edit ${type}` : `Tambah ${type}`;
            document.getElementById('f-type').value = type;
            document.getElementById('f-id').value = data ? data[0] : `ID-${Date.now()}`; // Auto Gen ID
            
            const container = document.getElementById('form-fields');
            container.innerHTML = '';

            const createInp = (lbl, name, val, ph='', type='text') => {
                if(type === 'textarea') return `<div><label class="label">${lbl}</label><textarea name="${name}" class="input-field h-24">${val||''}</textarea></div>`;
                if(type === 'select') return `<div><label class="label">${lbl}</label><select name="${name}" class="input-field">${val}</select></div>`;
                return `<div><label class="label">${lbl}</label><input name="${name}" value="${val||''}" placeholder="${ph}" class="input-field"></div>`;
            };

            if(type === 'Guru') {
                // 0:ID, 1:User, 2:Pass, 3:Nama, 4:NIP, 5:Jabatan, 6:Email, 7:Foto
                container.innerHTML += createInp("Nama Lengkap", "f3", data?.[3]);
                container.innerHTML += createInp("NIP", "f4", data?.[4]);
                container.innerHTML += createInp("Jabatan", "f5", data?.[5], "Contoh: Guru Kelas 1A");
                container.innerHTML += createInp("URL Foto", "f7", data?.[7], "https://...");
            } else if(type === 'Berita') {
                // 0:ID, 1:Judul, 2:Tgl, 3:Isi, 4:Foto
                container.innerHTML += createInp("Judul Berita", "f1", data?.[1]);
                container.innerHTML += createInp("Isi Berita", "f3", data?.[3], "", "textarea");
                container.innerHTML += createInp("URL Foto", "f4", data?.[4]);
            } else if(type === 'Galeri') {
                 // 0:ID, 1:Tipe, 2:Judul, 3:Link
                const opts = `<option value="Foto" ${data?.[1]=='Foto'?'selected':''}>Foto Biasa</option><option value="Banner" ${data?.[1]=='Banner'?'selected':''}>Banner Slider</option>`;
                container.innerHTML += createInp("Tipe", "f1", opts, "", "select");
                container.innerHTML += createInp("Judul/Keterangan", "f2", data?.[2]);
                container.innerHTML += createInp("URL Gambar", "f3", data?.[3]);
            } else if(type === 'Fasilitas') {
                // 0:ID, 1:Kategori, 2:Nama, 3:Foto
                container.innerHTML += createInp("Kategori", "f1", data?.[1], "Sapras / Ekstrakulikuler");
                container.innerHTML += createInp("Nama Fasilitas", "f2", data?.[2]);
                container.innerHTML += createInp("URL Foto/Ikon", "f3", data?.[3]);
            } else if(type === 'Downloads') {
                // 0:ID, 1:Nama, 2:Kategori, 3:Link
                container.innerHTML += createInp("Nama File", "f1", data?.[1]);
                container.innerHTML += createInp("Link Download", "f3", data?.[3]);
                container.innerHTML += createInp("Kategori", "f2", data?.[2], "Umum");
            }
        }

        function closeForm() { document.getElementById('modal-form').classList.add('hidden'); }

        async function submitForm(e) {
            e.preventDefault();
            const form = e.target;
            const type = form.querySelector('#f-type').value;
            const id = form.querySelector('#f-id').value;
            
            // Susun Data Array berdasarkan Tipe
            let newData = [];
            if(type === 'Guru') {
                newData = [id, "user", "pass", form.f3.value, form.f4.value, form.f5.value, "", form.f7.value];
            } else if(type === 'Berita') {
                const tgl = new Date().toLocaleDateString('id-ID');
                newData = [id, form.f1.value, tgl, form.f3.value, form.f4.value];
            } else if(type === 'Galeri') {
                newData = [id, form.f1.value, form.f2.value, form.f3.value];
            } else if(type === 'Fasilitas') {
                newData = [id, form.f1.value, form.f2.value, form.f3.value];
            } else if(type === 'Downloads') {
                newData = [id, form.f1.value, form.f2.value, form.f3.value];
            }

            const btn = form.querySelector('button');
            btn.innerText = "Menyimpan...";
            
            await sendToBackend({ action: 'saveGeneral', sheet: type, id: id, data: newData });
            closeForm();
            btn.innerText = "Simpan Data";
            refreshData();
        }

        // --- SAVE FUNCTIONS ---
        async function saveData(e, type) {
            e.preventDefault();
            if(type === 'config') {
                const data = {};
                // Ambil semua input id^="adm-"
                document.querySelectorAll('[id^="adm-"]').forEach(el => {
                    const key = el.id.replace('adm-', '');
                    data[key] = el.value;
                });
                await sendToBackend({ action: 'saveConfig', data: data });
            }
        }

        async function saveBulk(sheet) {
            let data = [];
            if(sheet === 'Siswa') {
                 // Ambil dari table inputs
                 const rows = document.getElementById('list-Siswa').querySelectorAll('tr');
                 rows.forEach((r, i) => {
                     const k = r.cells[0].innerText;
                     const l = document.getElementById(`sis-l-${i}`).value;
                     const p = document.getElementById(`sis-p-${i}`).value;
                     data.push([k, l, p]);
                 });
            } else if(sheet === 'Mutasi') {
                 const rows = document.getElementById('list-Mutasi').querySelectorAll('tr');
                 rows.forEach((r, i) => {
                     const k = r.cells[0].innerText;
                     data.push([
                         k, 
                         document.getElementById(`mut-1-${i}`).value,
                         document.getElementById(`mut-2-${i}`).value,
                         document.getElementById(`mut-3-${i}`).value,
                         document.getElementById(`mut-4-${i}`).value
                     ]);
                 });
            }
            await sendToBackend({ action: 'saveBulk', sheet: sheet, data: data });
            refreshData();
        }

        async function deleteItem(sheet, id) {
            if(confirm("Hapus data ini permanen?")) {
                await sendToBackend({ action: 'deleteGeneral', sheet: sheet, id: id });
                refreshData();
            }
        }

        async function kirimSPMB(e) {
            e.preventDefault();
            const d = {
                nama: e.target.nama.value,
                nik: e.target.nik.value,
                hp: e.target.hp.value
            };
            const btn = e.target.querySelector('button');
            btn.innerText = "Mengirim...";
            await sendToBackend({ action: 'submitSPMB', data: d });
            alert("Pendaftaran Terkirim!");
            document.getElementById('modal-spmb').classList.add('hidden');
            btn.innerText = "Kirim Pendaftaran";
        }

        // --- BACKEND HELPER ---
        async function sendToBackend(payload) {
            try {
                await fetch(API_URL, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                // alert("Berhasil disimpan!"); 
            } catch(e) {
                alert("Gagal koneksi ke server.");
            }
        }

        async function refreshData() {
            await initApp();
            // Re-render tab yang aktif
            document.querySelectorAll('.admin-tab').forEach(b => {
                 // Logic check active tab simpel aja, reload UI admin
            });
            const activeTab = document.querySelector('.tab-content:not(.hidden)').id.replace('tab-','');
            renderAdminData(activeTab);
        }

        function handleLoginButton() { if(isAdmin) doLogout(); else document.getElementById('modal-login').classList.remove('hidden'); }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }
        
        function startBannerScroll() {
            const c = document.getElementById('banner-track');
            setInterval(() => {
                if(c && c.scrollWidth) {
                     if (c.scrollLeft + c.clientWidth >= c.scrollWidth - 10) c.scrollTo({ left: 0, behavior: 'smooth' });
                     else c.scrollBy({ left: 300, behavior: 'smooth' });
                }
            }, 4000);
        }
    </script>
</body>
</html>